# å¥åº·æ£€æŸ¥è·¯å¾„ä¿®å¤è¯´æ˜

## ğŸ” é—®é¢˜å‘ç°

åœ¨æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£æ—¶å‘ç°è·¯å¾„ä¸åŒ¹é…ï¼š

- âŒ é”™è¯¯è·¯å¾„ï¼š`http://192.168.1.115:8000/api/v1/health` â†’ 404é”™è¯¯
- âœ… æ­£ç¡®è·¯å¾„ï¼š`http://192.168.1.115:8000/api/health` â†’ æ­£å¸¸è¿”å›

## ğŸ“‹ è·¯å¾„åˆ†æ

### åç«¯æ§åˆ¶å™¨é…ç½®
```typescript
// apps/backend/src/controller/health.controller.ts
@Controller('/health')  // æ§åˆ¶å™¨è·¯å¾„ï¼š/health
export class HealthController {
  @Get('/')  // æ–¹æ³•è·¯å¾„ï¼š/
  async health() {
    // å¥åº·æ£€æŸ¥é€»è¾‘
  }
}
```

### å®é™…APIè·¯å¾„
- **å®Œæ•´è·¯å¾„**ï¼š`/health` + `/` = `/health`
- **é€šè¿‡nginxä»£ç†**ï¼š`/api/health`ï¼ˆnginxå°† `/api/` ä»£ç†åˆ°åç«¯ï¼‰

### ä¸ºä»€ä¹ˆä¸æ˜¯ `/api/v1/health`ï¼Ÿ
å¥åº·æ£€æŸ¥æ¥å£é€šå¸¸è®¾è®¡ä¸ºï¼š
1. **æ— ç‰ˆæœ¬å·** - å¥åº·æ£€æŸ¥æ˜¯åŸºç¡€è®¾æ–½æ¥å£ï¼Œä¸éœ€è¦ç‰ˆæœ¬æ§åˆ¶
2. **ç®€å•è·¯å¾„** - ä¾¿äºç›‘æ§ç³»ç»Ÿå’Œè´Ÿè½½å‡è¡¡å™¨è°ƒç”¨
3. **ç‹¬ç«‹äºä¸šåŠ¡API** - ä¸å—APIç‰ˆæœ¬å˜æ›´å½±å“

## ğŸ› ï¸ ä¿®å¤å†…å®¹

### 1. éƒ¨ç½²è„šæœ¬ä¿®å¤
```bash
# scripts/deploy-production.sh
HEALTH_URL="http://192.168.1.115:8000/api/health"  # ä¿®å¤è·¯å¾„

# scripts/deploy-production.ps1  
$HealthUrl = "http://192.168.1.115:8000/api/health"  # ä¿®å¤è·¯å¾„
```

### 2. æ–‡æ¡£æ›´æ–°
- âœ… `DEPLOYMENT_GUIDE.md` - æ›´æ–°å¥åº·æ£€æŸ¥URL
- âœ… `API_PATH_FIX_SUMMARY.md` - æ›´æ–°éªŒè¯å‘½ä»¤
- âœ… éƒ¨ç½²è„šæœ¬ä¸­çš„å¥åº·æ£€æŸ¥é€»è¾‘

### 3. Dockeré…ç½®ç¡®è®¤
Dockerå®¹å™¨çš„å¥åº·æ£€æŸ¥é…ç½®æ˜¯æ­£ç¡®çš„ï¼š
```yaml
healthcheck:
  test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost/health"]
```

## ğŸ§ª éªŒè¯æµ‹è¯•

### æ­£ç¡®çš„å¥åº·æ£€æŸ¥æ¥å£
```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
curl http://192.168.1.115:8000/api/health

# é¢„æœŸè¿”å›
{
  "status": "ok",
  "timestamp": "2025-06-17T08:50:08.235Z",
  "uptime": 43.852150076,
  "version": "1.0.0",
  "environment": "production",
  "checks": {
    "database": "ok",
    "memory": "ok"
  },
  "memory": {
    "heapUsed": "26MB",
    "heapTotal": "28MB",
    "external": "2MB"
  }
}
```

### å…¶ä»–å¥åº·æ£€æŸ¥ç«¯ç‚¹
```bash
# ç®€å•å¥åº·æ£€æŸ¥
curl http://192.168.1.115:8000/api/health/simple
# è¿”å›ï¼š{"status": "ok"}

# å°±ç»ªæ£€æŸ¥
curl http://192.168.1.115:8000/api/health/ready
# è¿”å›ï¼š{"status": "ready"}

# å­˜æ´»æ£€æŸ¥
curl http://192.168.1.115:8000/api/health/live
# è¿”å›ï¼š{"status": "alive", "timestamp": "...", "uptime": ...}
```

## ğŸ“Š APIè·¯å¾„æ€»ç»“

### å¥åº·æ£€æŸ¥ç›¸å…³æ¥å£
- `/api/health` - å®Œæ•´å¥åº·æ£€æŸ¥
- `/api/health/simple` - ç®€å•çŠ¶æ€æ£€æŸ¥
- `/api/health/ready` - å°±ç»ªæ£€æŸ¥
- `/api/health/live` - å­˜æ´»æ£€æŸ¥

### ä¸šåŠ¡APIæ¥å£
- `/api/v1/auth/login` - ç”¨æˆ·ç™»å½•
- `/api/v1/contracts` - åˆåŒç®¡ç†
- `/api/v1/invoices` - å‘ç¥¨ç®¡ç†
- `/api/v1/attachments` - é™„ä»¶ç®¡ç†

### å…¶ä»–æ¥å£
- `/api-docs` - APIæ–‡æ¡£
- `/` - å‰ç«¯é¡µé¢

## ğŸ¯ æœ€ä½³å®è·µ

### å¥åº·æ£€æŸ¥è®¾è®¡åŸåˆ™
1. **è·¯å¾„ç®€å•** - ä½¿ç”¨ `/health` è€Œä¸æ˜¯ `/api/v1/health`
2. **å“åº”å¿«é€Ÿ** - é¿å…å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
3. **ä¿¡æ¯ä¸°å¯Œ** - åŒ…å«å…³é”®ç»„ä»¶çŠ¶æ€
4. **æ ‡å‡†æ ¼å¼** - ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼

### ç›‘æ§é›†æˆ
```bash
# Kubernetes liveness probe
livenessProbe:
  httpGet:
    path: /api/health/live
    port: 80
  initialDelaySeconds: 30
  periodSeconds: 10

# Kubernetes readiness probe  
readinessProbe:
  httpGet:
    path: /api/health/ready
    port: 80
  initialDelaySeconds: 5
  periodSeconds: 5
```

### è´Ÿè½½å‡è¡¡å™¨é…ç½®
```nginx
# Nginx upstream health check
upstream backend {
    server 192.168.1.115:8080;
    # health_check uri=/health;
}
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **è·¯å¾„ä¸€è‡´æ€§** - ç¡®ä¿æ‰€æœ‰é…ç½®ä½¿ç”¨ç›¸åŒçš„å¥åº·æ£€æŸ¥è·¯å¾„
2. **ç½‘ç»œè®¿é—®** - å¥åº·æ£€æŸ¥è·¯å¾„åº”è¯¥å¯ä»¥ä»ç›‘æ§ç³»ç»Ÿè®¿é—®
3. **å“åº”æ—¶é—´** - å¥åº·æ£€æŸ¥åº”è¯¥å¿«é€Ÿå“åº”ï¼Œé¿å…è¶…æ—¶
4. **é”™è¯¯å¤„ç†** - å¥åº·æ£€æŸ¥å¤±è´¥æ—¶åº”è¯¥è¿”å›é€‚å½“çš„HTTPçŠ¶æ€ç 

## ğŸ“ˆ ç›‘æ§å»ºè®®

### ç›‘æ§æŒ‡æ ‡
- **å“åº”æ—¶é—´** - å¥åº·æ£€æŸ¥æ¥å£çš„å“åº”æ—¶é—´
- **æˆåŠŸç‡** - å¥åº·æ£€æŸ¥çš„æˆåŠŸç‡
- **æ•°æ®åº“çŠ¶æ€** - æ•°æ®åº“è¿æ¥çŠ¶æ€
- **å†…å­˜ä½¿ç”¨** - åº”ç”¨å†…å­˜ä½¿ç”¨æƒ…å†µ

### å‘Šè­¦è§„åˆ™
```yaml
# Prometheus å‘Šè­¦è§„åˆ™ç¤ºä¾‹
- alert: HealthCheckFailed
  expr: up{job="contract-ledger"} == 0
  for: 1m
  labels:
    severity: critical
  annotations:
    summary: "åº”ç”¨å¥åº·æ£€æŸ¥å¤±è´¥"
    description: "åˆåŒç®¡ç†ç³»ç»Ÿå¥åº·æ£€æŸ¥è¿ç»­å¤±è´¥è¶…è¿‡1åˆ†é’Ÿ"
```

## ğŸ‰ æ€»ç»“

å¥åº·æ£€æŸ¥è·¯å¾„ä¿®å¤å®Œæˆï¼š
- âœ… æ­£ç¡®è·¯å¾„ï¼š`/api/health`
- âœ… éƒ¨ç½²è„šæœ¬å·²æ›´æ–°
- âœ… æ–‡æ¡£å·²åŒæ­¥æ›´æ–°
- âœ… éªŒè¯æµ‹è¯•é€šè¿‡

ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨æ­£ç¡®çš„å¥åº·æ£€æŸ¥è·¯å¾„è¿›è¡Œç›‘æ§å’Œéƒ¨ç½²éªŒè¯äº†ï¼
