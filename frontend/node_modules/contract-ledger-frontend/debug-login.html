<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>登录调试页面</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .form-group { margin: 10px 0; }
    input, button { padding: 10px; margin: 5px; }
    .error { color: red; }
    .success { color: green; }
    .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>登录调试页面</h1>
  
  <div class="form-group">
    <input type="text" id="username" placeholder="用户名" value="admin">
  </div>
  <div class="form-group">
    <input type="password" id="password" placeholder="密码" value="123456">
  </div>
  <div class="form-group">
    <button id="loginBtn">登录</button>
    <button id="testConfigBtn">测试配置</button>
  </div>
  
  <div id="result"></div>
  <div id="debug" class="debug"></div>

  <script type="module">
    const resultDiv = document.getElementById('result');
    const debugDiv = document.getElementById('debug');
    
    function log(message, type = 'info') {
      console.log(message);
      const p = document.createElement('p');
      p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      p.className = type;
      resultDiv.appendChild(p);
    }
    
    function debug(message) {
      debugDiv.innerHTML += `<p>${message}</p>`;
    }

    // 测试配置加载
    document.getElementById('testConfigBtn').addEventListener('click', async () => {
      try {
        debug('开始测试配置...');
        
        // 测试配置文件加载
        const { getBaseUrl, getApiConfig } = await import('./assets/js/config/api.js');
        const baseUrl = getBaseUrl();
        const config = getApiConfig();
        
        debug(`Base URL: ${baseUrl}`);
        debug(`Config: ${JSON.stringify(config, null, 2)}`);
        
        // 测试API服务加载
        const ApiService = (await import('./assets/js/services/api.js')).default;
        const apiService = new ApiService();
        debug(`API Service Base URL: ${apiService.baseUrl}`);
        
        // 测试认证服务加载
        const authService = (await import('./assets/js/services/auth.js')).default;
        debug(`Auth Service Base URL: ${authService.baseUrl}`);
        
        log('配置测试完成', 'success');
      } catch (error) {
        log(`配置测试失败: ${error.message}`, 'error');
        debug(`错误详情: ${error.stack}`);
      }
    });

    // 测试登录
    document.getElementById('loginBtn').addEventListener('click', async () => {
      try {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        log('开始登录测试...');
        debug(`用户名: ${username}, 密码: ${password}`);
        
        // 直接使用fetch测试
        const response = await fetch('http://127.0.0.1:8080/api/v1/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, password })
        });
        
        debug(`响应状态: ${response.status}`);
        const data = await response.json();
        debug(`响应数据: ${JSON.stringify(data, null, 2)}`);
        
        if (response.ok && data.access_token) {
          log('登录成功！', 'success');
        } else {
          log('登录失败', 'error');
        }
        
      } catch (error) {
        log(`登录错误: ${error.message}`, 'error');
        debug(`错误详情: ${error.stack}`);
      }
    });
    
    // 页面加载时的初始化测试
    log('页面已加载，开始初始化测试...');
    debug('检查模块支持...');
    
    if (typeof import === 'function') {
      debug('✓ ES模块支持正常');
    } else {
      debug('✗ ES模块不支持');
    }
  </script>
</body>
</html>
