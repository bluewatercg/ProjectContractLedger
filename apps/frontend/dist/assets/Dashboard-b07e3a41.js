/* empty css                  *//* empty css                   *//* empty css               */import{J as C,K as _,d as Q,r as w,o as W,c as L,b as s,L as X,w as a,M as Y,e,N as Z,t as l,h as tt,n as f,O as st,z as v,F as et,v as at,P as ot,l as k,g as m}from"./index-2473cdd3.js";import{_ as nt}from"./_plugin-vue_export-helper-c27b6911.js";const O={async getDashboardStats(o=!0){const c="dashboard_stats";if(o){const n=C.get(c,!0);if(n)return console.log("Dashboard stats loaded from cache"),n}console.log("Fetching fresh dashboard stats from API");const r=Date.now();try{const u=(await _.get("/statistics/dashboard")).data,g=Date.now();return console.log(`Dashboard stats API call took ${g-r}ms`),u.success&&C.set(c,u,180,!0),u}catch(n){throw console.error("Failed to fetch dashboard stats:",n),n}},getMonthlyRevenueTrend(o){return _.get("/statistics/revenue/trend",{params:{months:o}}).then(c=>c.data)},getCustomerDistribution(){return _.get("/statistics/customers/distribution").then(o=>o.data)},getContractStatusDistribution(){return _.get("/statistics/contracts/status").then(o=>o.data)},getInvoiceStatusDistribution(){return _.get("/statistics/invoices/status").then(o=>o.data)},getPaymentMethodStats(){return _.get("/statistics/payments/methods").then(o=>o.data)},getOverdueInvoicesAlert(){return _.get("/statistics/alerts/overdue").then(o=>o.data)},clearCache(){C.delete("dashboard_stats"),console.log("Statistics cache cleared")},async refreshDashboardStats(){return this.clearCache(),this.getDashboardStats(!1)}},rt={class:"page-container"},ct={class:"page-header"},dt={class:"header-actions"},it={class:"card-grid"},lt={class:"stat-card"},ut={class:"stat-card-header"},_t={class:"stat-card-value"},vt={class:"stat-card-change"},mt={class:"stat-card"},ht={class:"stat-card-header"},pt={class:"stat-card-value"},ft={class:"stat-card-change"},gt={class:"stat-card"},yt={class:"stat-card-header"},bt={class:"stat-card-value"},Dt={class:"stat-card-change"},Ct={class:"stat-card"},wt={class:"stat-card-header"},kt={class:"stat-card-value"},St={class:"stat-card-change"},$t={class:"quick-actions"},Tt={class:"action-buttons"},It=Q({__name:"Dashboard",setup(o){tt();const c=w(!1),r=w(),n=w(),u=d=>new Intl.NumberFormat("zh-CN").format(d),g=async(d=!0)=>{try{c.value=!0;const t=Date.now(),h=await O.getDashboardStats(d);if(h.success){r.value=h.data;const b=Date.now();n.value=b-t,console.log(`Dashboard loaded in ${n.value}ms`),n.value>1e3&&f.info(`数据加载完成 (${n.value}ms)`)}else f.error(h.message||"获取统计数据失败")}catch(t){console.error("Failed to fetch stats:",t),f.error("获取统计数据失败，请稍后重试")}finally{c.value=!1}},U=async()=>{try{await O.refreshDashboardStats(),await g(!1),f.success("数据已刷新")}catch{f.error("刷新数据失败")}};return W(()=>{g()}),(d,t)=>{var S,$,T,I,M,N,A,P,B,E,F,R,V,z,x,K;const h=st,b=v("Refresh"),i=et,p=at,q=v("User"),J=v("Document"),j=v("Money"),G=v("Tickets"),y=v("Plus"),H=ot;return k(),L("div",rt,[s("div",ct,[t[5]||(t[5]=s("h2",{class:"page-title"},"仪表板",-1)),s("div",dt,[n.value?(k(),X(h,{key:0,type:"info",size:"small"},{default:a(()=>[m(" 加载时间: "+l(n.value)+"ms ",1)]),_:1})):Y("",!0),e(p,{type:"primary",onClick:U,loading:c.value},{default:a(()=>[e(i,null,{default:a(()=>[e(b)]),_:1}),t[4]||(t[4]=m(" 刷新数据 "))]),_:1,__:[4]},8,["loading"])])]),Z((k(),L("div",it,[s("div",lt,[s("div",ut,[t[6]||(t[6]=s("span",{class:"stat-card-title"},"总客户数",-1)),e(i,{class:"stat-card-icon"},{default:a(()=>[e(q)]),_:1})]),s("div",_t,l((($=(S=r.value)==null?void 0:S.customers)==null?void 0:$.total)||0),1),s("div",vt,"活跃客户: "+l(((I=(T=r.value)==null?void 0:T.customers)==null?void 0:I.active)||0),1)]),s("div",mt,[s("div",ht,[t[7]||(t[7]=s("span",{class:"stat-card-title"},"总合同数",-1)),e(i,{class:"stat-card-icon"},{default:a(()=>[e(J)]),_:1})]),s("div",pt,l(((N=(M=r.value)==null?void 0:M.contracts)==null?void 0:N.total)||0),1),s("div",ft,"执行中: "+l(((P=(A=r.value)==null?void 0:A.contracts)==null?void 0:P.active)||0),1)]),s("div",gt,[s("div",yt,[t[8]||(t[8]=s("span",{class:"stat-card-title"},"总收入",-1)),e(i,{class:"stat-card-icon"},{default:a(()=>[e(j)]),_:1})]),s("div",bt,"¥"+l(u(((E=(B=r.value)==null?void 0:B.summary)==null?void 0:E.totalRevenue)||0)),1),s("div",Dt,"已收: ¥"+l(u(((R=(F=r.value)==null?void 0:F.summary)==null?void 0:R.paidAmount)||0)),1)]),s("div",Ct,[s("div",wt,[t[9]||(t[9]=s("span",{class:"stat-card-title"},"待收款",-1)),e(i,{class:"stat-card-icon"},{default:a(()=>[e(G)]),_:1})]),s("div",kt,"¥"+l(u(((z=(V=r.value)==null?void 0:V.summary)==null?void 0:z.unpaidAmount)||0)),1),s("div",St,"逾期: "+l(((K=(x=r.value)==null?void 0:x.invoices)==null?void 0:K.overdue)||0)+" 张",1)])])),[[H,c.value]]),s("div",$t,[t[14]||(t[14]=s("h3",null,"快速操作",-1)),s("div",Tt,[e(p,{type:"primary",onClick:t[0]||(t[0]=D=>d.$router.push("/customers/create"))},{default:a(()=>[e(i,null,{default:a(()=>[e(y)]),_:1}),t[10]||(t[10]=m(" 新建客户 "))]),_:1,__:[10]}),e(p,{type:"success",onClick:t[1]||(t[1]=D=>d.$router.push("/contracts/create"))},{default:a(()=>[e(i,null,{default:a(()=>[e(y)]),_:1}),t[11]||(t[11]=m(" 新建合同 "))]),_:1,__:[11]}),e(p,{type:"warning",onClick:t[2]||(t[2]=D=>d.$router.push("/invoices/create"))},{default:a(()=>[e(i,null,{default:a(()=>[e(y)]),_:1}),t[12]||(t[12]=m(" 新建发票 "))]),_:1,__:[12]}),e(p,{type:"info",onClick:t[3]||(t[3]=D=>d.$router.push("/payments/create"))},{default:a(()=>[e(i,null,{default:a(()=>[e(y)]),_:1}),t[13]||(t[13]=m(" 新建支付 "))]),_:1,__:[13]})])])])}}});const Et=nt(It,[["__scopeId","data-v-d3dcd404"]]);export{Et as default};
