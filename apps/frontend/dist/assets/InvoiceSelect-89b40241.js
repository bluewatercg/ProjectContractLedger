/* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{d as $,r as i,$ as S,L as d,w as u,a0 as O,z as P,Q as A,l as c,c as B,Y as K,b as h,t as w,X as Q,e as U,f as X,M as z,g as Y,T as j,F as q}from"./index-2e96782b.js";import{i as N}from"./invoice-fb399ae5.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";const H={class:"invoice-option"},J={class:"invoice-number"},R={class:"invoice-info"},W={key:1},Z=10,ee=$({__name:"InvoiceSelect",props:{modelValue:{},placeholder:{default:"请选择发票"},width:{default:"100%"},disabled:{type:Boolean,default:!1},contractId:{},customerId:{},status:{}},emits:["update:modelValue","change"],setup(D,{emit:E}){const o=D,V=E,m=i(o.modelValue||null),t=i([]),v=i(!1),f=i(!1),y=i(""),g=i(1),_=i(!0);let I=null;const C=e=>new Intl.NumberFormat("zh-CN").format(e),x=e=>e?new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"";S(()=>o.modelValue,async e=>{m.value=e||null,e&&!t.value.find(a=>a.id===e)&&await k(e)}),S(m,e=>{V("update:modelValue",e)});const k=async e=>{try{const a=await N.getInvoiceById(e);if(a.success&&a.data){const l=t.value.findIndex(s=>s.id===e);l===-1?t.value.unshift(a.data):t.value[l]=a.data}}catch(a){console.error("Failed to load invoice by id:",a)}},b=async(e="",a=1,l=!1)=>{try{a===1?v.value=!0:f.value=!0;const s={page:a,limit:Z,search:e.trim(),sortBy:"created_at",sortOrder:"DESC"};o.contractId&&(s.contractId=o.contractId),o.customerId&&(s.customerId=o.customerId),o.status&&(s.status=o.status);const r=await N.getInvoices(s);if(r.success&&r.data){const p=r.data.items;l?t.value=[...t.value,...p]:t.value=p,g.value=a,_.value=a<r.data.totalPages}}catch(s){console.error("Failed to search invoices:",s)}finally{v.value=!1,f.value=!1}},F=e=>{y.value=e,I&&clearTimeout(I),I=setTimeout(()=>{g.value=1,_.value=!0,b(e,1,!1)},300)},L=async()=>{_.value&&!f.value&&await b(y.value,g.value+1,!0)},M=e=>{const a=t.value.find(l=>l.id===e)||null;V("change",e,a)},T=async e=>{e&&t.value.length===0&&await b("",1,!1)};return(async()=>{o.modelValue&&await k(o.modelValue)})(),(e,a)=>{const l=j,s=P("Loading"),r=q,p=A;return c(),d(p,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=n=>m.value=n),placeholder:e.placeholder,style:O({width:e.width}),filterable:"",remote:"","reserve-keyword":"","remote-method":F,loading:v.value,clearable:"",onChange:M,onVisibleChange:T},{default:u(()=>[(c(!0),B(Q,null,K(t.value,n=>(c(),d(l,{key:n.id,label:`${x(n.issue_date)} | ¥${C(n.amount)}`,value:n.id},{default:u(()=>[h("div",H,[h("div",J,w(x(n.issue_date))+" | ¥"+w(C(n.amount)),1),h("div",R,w(n.invoice_number),1)])]),_:2},1032,["label","value"]))),128)),_.value&&t.value.length>0?(c(),d(l,{key:0,value:"loading",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>[h("div",{onClick:X(L,["stop"]),style:{cursor:"pointer",padding:"8px"}},[f.value?(c(),d(r,{key:0},{default:u(()=>[U(s)]),_:1})):(c(),B("span",W,"点击加载更多..."))])]),_:1})):z("",!0),!v.value&&t.value.length===0&&y.value?(c(),d(l,{key:1,value:"no-data",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>a[1]||(a[1]=[Y(" 未找到相关发票 ")])),_:1,__:[1]})):z("",!0)]),_:1},8,["modelValue","placeholder","style","loading"])}}});const re=G(ee,[["__scopeId","data-v-ab580427"]]);export{re as I};
