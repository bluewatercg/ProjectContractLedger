/* empty css                  *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";import{d as A,r as i,o as Q,c as q,b as c,e as a,w as o,N as G,L as H,h as J,z as K,v as W,Q as X,R as Y,S as Z,P as ee,l as w,g as s,t as _,y as te,n as ae,F as ne,T as oe,U as le,O as se}from"./index-94d61daa.js";import{p as P}from"./payment-73077a14.js";import{I as ie}from"./InvoiceSelect-a6f8b053.js";import{_ as re}from"./_plugin-vue_export-helper-c27b6911.js";import"./invoice-1ef6f00a.js";const pe={class:"page-container"},ce={class:"page-header"},ue={class:"table-container"},de={class:"table-toolbar"},me={class:"table-search"},_e={class:"pagination-container"},ve=A({__name:"PaymentList",setup(fe){const y=J(),v=i(!1),h=i([]),u=i(null),f=i(""),r=i(1),g=i(10),b=i(0),z=t=>new Intl.NumberFormat("zh-CN").format(t),x=t=>{if(!t)return"-";const e=new Date(t);return isNaN(e.getTime())?"-":e.toLocaleDateString("zh-CN")},k=t=>({cash:"现金",bank_transfer:"银行转账",check:"支票",credit_card:"信用卡",other:"其他"})[t]||t,E=t=>({pending:"warning",completed:"success",failed:"danger"})[t]||"info",T=t=>({pending:"待处理",completed:"已完成",failed:"失败"})[t]||t,p=async()=>{try{v.value=!0;const t=await P.getPayments({page:r.value,limit:g.value,invoiceId:u.value||void 0,status:f.value});t.success&&t.data&&(h.value=t.data.items,b.value=t.data.total)}catch(t){console.error("Failed to fetch payments:",t)}finally{v.value=!1}},M=(t,e)=>{u.value=t,r.value=1,p()},S=()=>{r.value=1,p()},N=()=>{r.value=1,p()},V=()=>{p()},B=t=>{y.push(`/payments/${t}`)},F=t=>{y.push(`/payments/${t}/edit`)},I=async t=>{try{await te.confirm("确定要删除这条支付记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await P.deletePayment(t)).success&&(ae.success("删除成功"),p())}catch(e){e!=="cancel"&&console.error("Failed to delete payment:",e)}};return Q(()=>{p()}),(t,e)=>{const $=K("Plus"),D=ne,d=W,m=oe,L=X,l=le,U=se,O=Y,R=Z,j=ee;return w(),q("div",pe,[c("div",ce,[e[6]||(e[6]=c("h2",{class:"page-title"},"支付管理",-1)),a(d,{type:"primary",onClick:e[0]||(e[0]=n=>t.$router.push("/payments/create"))},{default:o(()=>[a(D,null,{default:o(()=>[a($)]),_:1}),e[5]||(e[5]=s(" 新建支付 "))]),_:1,__:[5]})]),c("div",ue,[c("div",de,[c("div",me,[a(ie,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=n=>u.value=n),placeholder:"选择发票筛选（支持搜索）",width:"250px",onChange:M},null,8,["modelValue"]),a(L,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=n=>f.value=n),placeholder:"状态筛选",style:{width:"120px"},onChange:S},{default:o(()=>[a(m,{label:"全部",value:""}),a(m,{label:"待处理",value:"pending"}),a(m,{label:"已完成",value:"completed"}),a(m,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])])]),G((w(),H(O,{data:h.value,style:{width:"100%"}},{default:o(()=>[a(l,{prop:"id",label:"支付ID",width:"80"}),a(l,{prop:"invoice.invoice_number",label:"发票编号",width:"150"}),a(l,{prop:"invoice.contract.customer.name",label:"客户名称"}),a(l,{prop:"amount",label:"支付金额",width:"120"},{default:o(({row:n})=>[s(" ¥"+_(z(n.amount)),1)]),_:1}),a(l,{prop:"payment_date",label:"支付日期",width:"120"},{default:o(({row:n})=>[s(_(x(n.payment_date)),1)]),_:1}),a(l,{prop:"payment_method",label:"支付方式",width:"120"},{default:o(({row:n})=>[s(_(k(n.payment_method)),1)]),_:1}),a(l,{prop:"reference_number",label:"参考号",width:"150"}),a(l,{prop:"status",label:"状态",width:"100"},{default:o(({row:n})=>[a(U,{type:E(n.status)},{default:o(()=>[s(_(T(n.status)),1)]),_:2},1032,["type"])]),_:1}),a(l,{label:"操作",width:"200"},{default:o(({row:n})=>[a(d,{size:"small",onClick:C=>B(n.id)},{default:o(()=>e[7]||(e[7]=[s("查看")])),_:2,__:[7]},1032,["onClick"]),a(d,{size:"small",type:"primary",onClick:C=>F(n.id)},{default:o(()=>e[8]||(e[8]=[s("编辑")])),_:2,__:[8]},1032,["onClick"]),a(d,{size:"small",type:"danger",onClick:C=>I(n.id)},{default:o(()=>e[9]||(e[9]=[s("删除")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,v.value]]),c("div",_e,[a(R,{"current-page":r.value,"onUpdate:currentPage":e[3]||(e[3]=n=>r.value=n),"page-size":g.value,"onUpdate:pageSize":e[4]||(e[4]=n=>g.value=n),total:b.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:N,onCurrentChange:V},null,8,["current-page","page-size","total"])])])])}}});const Ve=re(ve,[["__scopeId","data-v-e6f9f7a2"]]);export{Ve as default};
