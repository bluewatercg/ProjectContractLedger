/* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{d as L,r as n,$ as B,L as d,w as u,a0 as N,z as U,Q as W,l as i,c as k,Y as O,b as _,t as w,X as P,e as D,f as K,M as S,g as Q,T as X,F as Y}from"./index-94d61daa.js";import{c as I}from"./customer-d37927e9.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";const j={class:"customer-option"},q={class:"customer-name"},G={class:"customer-info"},H={key:1},J=10,R=L({__name:"CustomerSelect",props:{modelValue:{},placeholder:{default:"请选择客户"},width:{default:"100%"},disabled:{type:Boolean,default:!1},onlyWithUnpaidInvoices:{type:Boolean,default:!1},onlyWithActiveContracts:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(z,{emit:A}){const r=z,b=A,m=n(r.modelValue||null),t=n([]),v=n(!1),f=n(!1),y=n(""),g=n(1),p=n(!0);let C=null;B(()=>r.modelValue,async e=>{m.value=e||null,e&&!t.value.find(a=>a.id===e)&&await x(e)}),B(m,e=>{b("update:modelValue",e)});const x=async e=>{try{const a=await I.getCustomerById(e);if(a.success&&a.data){const l=t.value.findIndex(o=>o.id===e);l===-1?t.value.unshift(a.data):t.value[l]=a.data}}catch(a){console.error("Failed to load customer by id:",a)}},V=async(e="",a=1,l=!1)=>{try{a===1?v.value=!0:f.value=!0;const o={page:a,limit:J,search:e.trim(),sortBy:"name",sortOrder:"ASC"};r.onlyWithUnpaidInvoices&&(o.hasUnpaidInvoices=!0),r.onlyWithActiveContracts&&(o.hasActiveContracts=!0);const c=await I.getCustomers(o);if(c.success&&c.data){const h=c.data.items;l?t.value=[...t.value,...h]:t.value=h,g.value=a,p.value=a<c.data.totalPages}}catch(o){console.error("Failed to search customers:",o)}finally{v.value=!1,f.value=!1}},M=e=>{y.value=e,C&&clearTimeout(C),C=setTimeout(()=>{g.value=1,p.value=!0,V(e,1,!1)},300)},T=async()=>{p.value&&!f.value&&await V(y.value,g.value+1,!0)},E=e=>{const a=t.value.find(l=>l.id===e)||null;b("change",e,a)},F=async e=>{e&&t.value.length===0&&await V("",1,!1)};return(async()=>{r.modelValue&&await x(r.modelValue)})(),(e,a)=>{const l=X,o=U("Loading"),c=Y,h=W;return i(),d(h,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=s=>m.value=s),placeholder:e.placeholder,style:N({width:e.width}),filterable:"",remote:"","reserve-keyword":"","remote-method":M,loading:v.value,clearable:"",onChange:E,onVisibleChange:F},{default:u(()=>[(i(!0),k(P,null,O(t.value,s=>(i(),d(l,{key:s.id,label:s.name,value:s.id},{default:u(()=>[_("div",j,[_("div",q,w(s.name),1),_("div",G,w(s.contact_person)+" | "+w(s.phone),1)])]),_:2},1032,["label","value"]))),128)),p.value&&t.value.length>0?(i(),d(l,{key:0,value:"loading",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>[_("div",{onClick:K(T,["stop"]),style:{cursor:"pointer",padding:"8px"}},[f.value?(i(),d(c,{key:0},{default:u(()=>[D(o)]),_:1})):(i(),k("span",H,"点击加载更多..."))])]),_:1})):S("",!0),!v.value&&t.value.length===0&&y.value?(i(),d(l,{key:1,value:"no-data",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>a[1]||(a[1]=[Q(" 未找到相关客户 ")])),_:1,__:[1]})):S("",!0)]),_:1},8,["modelValue","placeholder","style","loading"])}}});const ie=$(R,[["__scopeId","data-v-d05fa7a6"]]);export{ie as C};
