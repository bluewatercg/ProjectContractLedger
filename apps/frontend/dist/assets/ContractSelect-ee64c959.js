/* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{d as D,r as n,$ as I,L as d,w as u,a0 as O,z as P,Q as A,l as r,c as k,Y as K,X as Q,b as h,e as U,f as X,M as S,g as Y,T as $,F as j,t as b}from"./index-d25e5bb6.js";import{c as B}from"./contract-1568625f.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";const G={class:"contract-option"},H={class:"contract-title"},J={class:"contract-info"},R={key:1},W=10,Z=D({__name:"ContractSelect",props:{modelValue:{},placeholder:{default:"请选择合同"},width:{default:"100%"},disabled:{type:Boolean,default:!1},customerId:{}},emits:["update:modelValue","change"],setup(z,{emit:N}){const c=z,w=N,m=n(c.modelValue||null),a=n([]),f=n(!1),v=n(!1),y=n(""),g=n(1),p=n(!0);let C=null;const E=e=>new Intl.NumberFormat("zh-CN").format(e);I(()=>c.modelValue,async e=>{m.value=e||null,e&&!a.value.find(t=>t.id===e)&&await x(e)}),I(m,e=>{w("update:modelValue",e)});const x=async e=>{try{const t=await B.getContractById(e);if(t.success&&t.data){const l=a.value.findIndex(o=>o.id===e);l===-1?a.value.unshift(t.data):a.value[l]=t.data}}catch(t){console.error("Failed to load contract by id:",t)}},V=async(e="",t=1,l=!1)=>{try{t===1?f.value=!0:v.value=!0;const o={page:t,limit:W,search:e.trim(),sortBy:"created_at",sortOrder:"DESC"};c.customerId&&(o.customerId=c.customerId);const i=await B.getContracts(o);if(i.success&&i.data){const _=i.data.items;l?a.value=[...a.value,..._]:a.value=_,g.value=t,p.value=t<i.data.totalPages}}catch(o){console.error("Failed to search contracts:",o)}finally{f.value=!1,v.value=!1}},F=e=>{y.value=e,C&&clearTimeout(C),C=setTimeout(()=>{g.value=1,p.value=!0,V(e,1,!1)},300)},M=async()=>{p.value&&!v.value&&await V(y.value,g.value+1,!0)},T=e=>{const t=a.value.find(l=>l.id===e)||null;w("change",e,t)},L=async e=>{e&&a.value.length===0&&await V("",1,!1)};return(async()=>{c.modelValue&&await x(c.modelValue)})(),(e,t)=>{const l=$,o=P("Loading"),i=j,_=A;return r(),d(_,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),placeholder:e.placeholder,style:O({width:e.width}),filterable:"",remote:"","reserve-keyword":"","remote-method":F,loading:f.value,clearable:"",onChange:T,onVisibleChange:L},{default:u(()=>[(r(!0),k(Q,null,K(a.value,s=>(r(),d(l,{key:s.id,label:s.title,value:s.id},{default:u(()=>[h("div",G,[h("div",H,b(s.title),1),h("div",J,b(s.contract_number)+" | ¥"+b(E(s.total_amount)),1)])]),_:2},1032,["label","value"]))),128)),p.value&&a.value.length>0?(r(),d(l,{key:0,value:"loading",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>[h("div",{onClick:X(M,["stop"]),style:{cursor:"pointer",padding:"8px"}},[v.value?(r(),d(i,{key:0},{default:u(()=>[U(o)]),_:1})):(r(),k("span",R,"点击加载更多..."))])]),_:1})):S("",!0),!f.value&&a.value.length===0&&y.value?(r(),d(l,{key:1,value:"no-data",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>t[1]||(t[1]=[Y(" 未找到相关合同 ")])),_:1,__:[1]})):S("",!0)]),_:1},8,["modelValue","placeholder","style","loading"])}}});const ce=q(Z,[["__scopeId","data-v-5069d278"]]);export{ce as C};
