/* empty css                  *//* empty css                   *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css                             */import{d as X,r as g,x as Y,o as Z,c as f,b as u,e as a,w as s,N as ee,L as te,M as I,h as ae,i as se,n as p,v as oe,V as le,a1 as ne,R as re,P as ue,l as _,g as l,t as n,W as ie,O as ce,a2 as de,a3 as me,U as pe}from"./index-2a26122f.js";import{i as _e}from"./invoice-db1afd57.js";import{F as ve,A as fe,a as N}from"./AttachmentList-a2b92fb4.js";import{_ as ye}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                   */const be={class:"page-container"},he={class:"page-header"},ge={key:1,class:"mt-6"},we={class:"payment-summary mb-4"},ke={class:"summary-item"},Ce={class:"summary-value total"},xe={class:"summary-item"},Ie={class:"summary-value paid"},Me={class:"summary-item"},Ae={class:"summary-value unpaid"},De={key:0},Ee={key:1,class:"text-center py-8 text-gray-500"},Ne={key:2,class:"mt-6"},Te={class:"mb-4"},Pe=X({__name:"InvoiceDetail",setup(Be){const y=ae(),T=se(),w=g(!1),o=g(),b=g([]),k=g(!1),v=Y(()=>Number(T.params.id)),m=e=>new Intl.NumberFormat("zh-CN").format(e),M=e=>new Date(e).toLocaleString("zh-CN"),P=e=>({draft:"info",sent:"warning",paid:"success",overdue:"danger",cancelled:"primary"})[e]||"info",B=e=>({draft:"草稿",sent:"已开票",paid:"已支付",overdue:"逾期",cancelled:"已取消"})[e]||e,S=e=>({cash:"现金",bank_transfer:"银行转账",check:"支票",credit_card:"信用卡",other:"其他"})[e]||e,$=e=>({pending:"warning",completed:"success",failed:"danger"})[e]||"info",R=e=>({pending:"待处理",completed:"已完成",failed:"失败"})[e]||e,A=()=>{var e;return!((e=o.value)!=null&&e.payments)||!Array.isArray(o.value.payments)?0:o.value.payments.filter(t=>t.status==="completed").reduce((t,c)=>t+Number(c.amount),0)},U=()=>o.value?Number(o.value.total_amount)-A():0,F=async()=>{try{w.value=!0;const e=await _e.getInvoiceById(v.value);e.success&&e.data&&(o.value=e.data)}catch(e){console.error("Failed to fetch invoice:",e),p.error("获取发票信息失败")}finally{w.value=!1}},L=()=>{y.push(`/invoices/${v.value}/edit`)},V=e=>{y.push(`/payments/${e}`)},z=e=>{y.push(`/payments/${e}/edit`)},O=()=>{y.push(`/payments/create?invoiceId=${v.value}`)},W=()=>{y.go(-1)},D=async()=>{try{k.value=!0;const e=await N.getInvoiceAttachments(v.value);e.success&&e.data&&(b.value=e.data)}catch(e){console.error("Failed to fetch attachments:",e),p.error("获取附件列表失败")}finally{k.value=!1}},j=e=>{b.value.unshift(e),p.success("附件上传成功")},q=e=>{console.error("Upload error:",e),p.error("附件上传失败")},G=async e=>{try{const t=await N.deleteInvoiceAttachment(v.value,e);t.success?(b.value=b.value.filter(c=>c.attachment_id!==e),p.success("附件删除成功")):p.error(t.message||"删除失败")}catch(t){console.error("Delete error:",t),p.error("删除附件失败")}};return Z(()=>{F(),D()}),(e,t)=>{const c=oe,i=ie,E=ce,H=le,C=de,x=me,J=ne,d=pe,K=re,Q=ue;return _(),f("div",be,[u("div",he,[t[2]||(t[2]=u("h2",{class:"page-title"},"发票详情",-1)),u("div",null,[a(c,{onClick:W},{default:s(()=>t[0]||(t[0]=[l("返回")])),_:1,__:[0]}),a(c,{type:"primary",onClick:L},{default:s(()=>t[1]||(t[1]=[l("编辑")])),_:1,__:[1]})])]),ee((_(),f("div",null,[o.value?(_(),te(H,{key:0,column:2,border:""},{default:s(()=>[a(i,{label:"发票编号"},{default:s(()=>[l(n(o.value.invoice_number),1)]),_:1}),a(i,{label:"合同标题"},{default:s(()=>{var r;return[l(n(((r=o.value.contract)==null?void 0:r.title)||"-"),1)]}),_:1}),a(i,{label:"客户名称"},{default:s(()=>{var r,h;return[l(n(((h=(r=o.value.contract)==null?void 0:r.customer)==null?void 0:h.name)||"-"),1)]}),_:1}),a(i,{label:"发票金额"},{default:s(()=>[l("¥"+n(m(o.value.amount)),1)]),_:1}),a(i,{label:"税率"},{default:s(()=>[l(n(o.value.tax_rate)+"%",1)]),_:1}),a(i,{label:"税额"},{default:s(()=>[l("¥"+n(m(o.value.tax_amount)),1)]),_:1}),a(i,{label:"总金额"},{default:s(()=>[l("¥"+n(m(o.value.total_amount)),1)]),_:1}),a(i,{label:"开票日期"},{default:s(()=>[l(n(o.value.issue_date),1)]),_:1}),a(i,{label:"状态"},{default:s(()=>[a(E,{type:P(o.value.status)},{default:s(()=>[l(n(B(o.value.status)),1)]),_:1},8,["type"])]),_:1}),a(i,{label:"创建时间"},{default:s(()=>[l(n(M(o.value.created_at)),1)]),_:1}),a(i,{label:"发票描述",span:2},{default:s(()=>[l(n(o.value.description||"-"),1)]),_:1}),a(i,{label:"备注",span:2},{default:s(()=>[l(n(o.value.notes||"-"),1)]),_:1})]),_:1})):I("",!0),o.value?(_(),f("div",ge,[t[10]||(t[10]=u("h3",{class:"text-lg font-semibold mb-4"},"支付情况",-1)),u("div",we,[a(J,{gutter:20},{default:s(()=>[a(x,{span:8},{default:s(()=>[a(C,{class:"summary-card"},{default:s(()=>[u("div",ke,[t[3]||(t[3]=u("div",{class:"summary-label"},"发票总额",-1)),u("div",Ce,"¥"+n(m(o.value.total_amount)),1)])]),_:1})]),_:1}),a(x,{span:8},{default:s(()=>[a(C,{class:"summary-card"},{default:s(()=>[u("div",xe,[t[4]||(t[4]=u("div",{class:"summary-label"},"已收款",-1)),u("div",Ie,"¥"+n(m(A())),1)])]),_:1})]),_:1}),a(x,{span:8},{default:s(()=>[a(C,{class:"summary-card"},{default:s(()=>[u("div",Me,[t[5]||(t[5]=u("div",{class:"summary-label"},"未收款",-1)),u("div",Ae,"¥"+n(m(U())),1)])]),_:1})]),_:1})]),_:1})]),o.value.payments&&o.value.payments.length>0?(_(),f("div",De,[a(K,{data:o.value.payments,border:"",style:{width:"100%"}},{default:s(()=>[a(d,{prop:"id",label:"支付ID",width:"80"}),a(d,{prop:"amount",label:"支付金额",width:"120"},{default:s(({row:r})=>[l(" ¥"+n(m(r.amount)),1)]),_:1}),a(d,{prop:"payment_date",label:"支付日期",width:"120"},{default:s(({row:r})=>[l(n(M(r.payment_date)),1)]),_:1}),a(d,{prop:"payment_method",label:"支付方式",width:"120"},{default:s(({row:r})=>[l(n(S(r.payment_method)),1)]),_:1}),a(d,{prop:"reference_number",label:"参考号",width:"150"}),a(d,{prop:"status",label:"状态",width:"100"},{default:s(({row:r})=>[a(E,{type:$(r.status)},{default:s(()=>[l(n(R(r.status)),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"notes",label:"备注"}),a(d,{label:"操作",width:"150"},{default:s(({row:r})=>[a(c,{size:"small",onClick:h=>V(r.id)},{default:s(()=>t[6]||(t[6]=[l("查看")])),_:2,__:[6]},1032,["onClick"]),a(c,{size:"small",type:"primary",onClick:h=>z(r.id)},{default:s(()=>t[7]||(t[7]=[l("编辑")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):(_(),f("div",Ee,[t[9]||(t[9]=u("p",null,"该发票暂无支付记录",-1)),a(c,{type:"primary",class:"mt-4",onClick:O},{default:s(()=>t[8]||(t[8]=[l("添加支付记录")])),_:1,__:[8]})]))])):I("",!0),o.value?(_(),f("div",Ne,[t[11]||(t[11]=u("h3",{class:"text-lg font-semibold mb-4"},"发票附件",-1)),u("div",Te,[a(ve,{"upload-url":`/invoices/${v.value}/attachments`,onSuccess:j,onError:q},null,8,["upload-url"])]),a(fe,{attachments:b.value,loading:k.value,onDelete:G,onRefresh:D},null,8,["attachments","loading"])])):I("",!0)])),[[Q,w.value]])])}}});const He=ye(Pe,[["__scopeId","data-v-be317d28"]]);export{He as default};
