# æ–‡ä»¶ä¸Šä¼ æˆåŠŸä½†é¢„è§ˆå¤±è´¥é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šä¸Šä¼ æœåŠ¡å™¨ä¸Šæç¤ºä¸Šä¼ æˆåŠŸï¼Œä½†é¢„è§ˆæç¤º `{"success":false,"message":"æ–‡ä»¶ä¸å­˜åœ¨"}`

## ğŸ” é—®é¢˜åˆ†æ

é€šè¿‡å¯¹ä»£ç å’Œé…ç½®çš„æ·±å…¥åˆ†æï¼Œå‘ç°äº†ä»¥ä¸‹å‡ ä¸ªå…³é”®é—®é¢˜ï¼š

### 1. Dockerå·æŒ‚è½½é—®é¢˜ â­ **ä¸»è¦é—®é¢˜**

**é—®é¢˜**: Dockeré…ç½®ä¸­çš„å·æŒ‚è½½è·¯å¾„å¯èƒ½ä¸å­˜åœ¨æˆ–æƒé™ä¸æ­£ç¡®
- é…ç½®: `./data/uploads:/app/uploads`
- å®¹å™¨å†…æ£€æŸ¥æ˜¾ç¤º `/app/uploads` ç›®å½•ä¸ºç©º
- å®¿ä¸»æœº `deployment/data/uploads` ç›®å½•å¯èƒ½ä¸å­˜åœ¨

### 2. æ–‡ä»¶è·¯å¾„ç”Ÿæˆé€»è¾‘

**å½“å‰é€»è¾‘**:
```typescript
// åˆåŒé™„ä»¶è·¯å¾„: /app/uploads/contracts/{contractId}/{filename}_{timestamp}.ext
// å‘ç¥¨é™„ä»¶è·¯å¾„: /app/uploads/invoices/{invoiceId}/{filename}_{timestamp}.ext
```

### 3. æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥

**é—®é¢˜**: ä¸Šä¼ æˆåŠŸä½†æ–‡ä»¶å®é™…æœªä¿å­˜åˆ°æ­£ç¡®ä½ç½®
- ä¸Šä¼ æ¥å£è¿”å›æˆåŠŸ
- æ•°æ®åº“è®°å½•åˆ›å»ºæˆåŠŸ
- ä½†ç‰©ç†æ–‡ä»¶æœªæ­£ç¡®ä¿å­˜

### 4. è°ƒè¯•ä¿¡æ¯ä¸è¶³

**é—®é¢˜**: ç¼ºå°‘è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œéš¾ä»¥å®šä½å…·ä½“é—®é¢˜

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä¿®å¤Dockerå·æŒ‚è½½ (æ¨è)

#### æ­¥éª¤1: åˆ›å»ºå®¿ä¸»æœºç›®å½•
```bash
cd deployment
mkdir -p data/uploads/contracts
mkdir -p data/uploads/invoices
mkdir -p data/logs
chmod -R 777 data/uploads/  # ç¡®ä¿å®¹å™¨å¯å†™
```

#### æ­¥éª¤2: é‡å¯å®¹å™¨
```bash
docker-compose down
docker-compose up -d
```

#### æ­¥éª¤3: éªŒè¯æŒ‚è½½
```bash
docker exec contract-ledger-backend ls -la /app/uploads/
```

### æ–¹æ¡ˆ2: å¢å¼ºé”™è¯¯å¤„ç†å’Œè°ƒè¯•

å·²å®æ–½çš„æ”¹è¿›:
1. **å¢å¼ºä¸Šä¼ æ¥å£è°ƒè¯•ä¿¡æ¯**
2. **å¢å¼ºä¸‹è½½/é¢„è§ˆæ¥å£è°ƒè¯•ä¿¡æ¯**
3. **æ·»åŠ æ–‡ä»¶æ“ä½œéªŒè¯**
4. **æ”¹è¿›é”™è¯¯å¤„ç†**

### æ–¹æ¡ˆ3: æƒé™å’Œè®¤è¯ä¿®å¤

ç¡®ä¿é¢„è§ˆåŠŸèƒ½çš„tokenä¼ é€’æ­£ç¡®:
```javascript
// å‰ç«¯é¢„è§ˆURL
previewUrl.value = `/api/v1/attachments/${attachment.attachment_id}/download?token=${token}`
```

## ğŸ› ï¸ å®æ–½æ­¥éª¤

### ç«‹å³æ‰§è¡Œ
1. **è¿è¡Œä¿®å¤è„šæœ¬**:
   ```bash
   chmod +x fix-upload-issue.sh
   ./fix-upload-issue.sh
   ```

2. **æ£€æŸ¥å®¹å™¨çŠ¶æ€**:
   ```bash
   docker-compose ps
   docker-compose logs -f backend
   ```

### æµ‹è¯•éªŒè¯
1. **ä¸Šä¼ æµ‹è¯•æ–‡ä»¶**
2. **æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¿å­˜åˆ°æ­£ç¡®ä½ç½®**
3. **æµ‹è¯•é¢„è§ˆåŠŸèƒ½**
4. **æ£€æŸ¥æ•°æ®åº“è®°å½•**

## ğŸ”§ è°ƒè¯•å·¥å…·

### 1. å®¹å™¨å†…è°ƒè¯•è„šæœ¬
```bash
docker cp debug-container-upload.sh contract-ledger-backend:/tmp/debug.sh
docker exec contract-ledger-backend chmod +x /tmp/debug.sh
docker exec contract-ledger-backend /tmp/debug.sh
```

### 2. æœ¬åœ°è°ƒè¯•è„šæœ¬
```bash
node debug-upload-issue.js
```

### 3. å®æ—¶æ—¥å¿—ç›‘æ§
```bash
docker-compose logs -f backend | grep -E "(ä¸Šä¼ |æ–‡ä»¶|é™„ä»¶)"
```

## ğŸ“Š é¢„æœŸç»“æœ

ä¿®å¤ååº”è¯¥çœ‹åˆ°:
1. âœ… å®¿ä¸»æœº `deployment/data/uploads/` ç›®å½•å­˜åœ¨ä¸”æœ‰æ­£ç¡®æƒé™
2. âœ… å®¹å™¨å†… `/app/uploads/` ç›®å½•å¯æ­£å¸¸è¯»å†™
3. âœ… ä¸Šä¼ çš„æ–‡ä»¶æ­£ç¡®ä¿å­˜åˆ°å­ç›®å½•ä¸­
4. âœ… é¢„è§ˆåŠŸèƒ½æ­£å¸¸å·¥ä½œ
5. âœ… è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—è¾“å‡º

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: å®¹å™¨é‡å¯åæ–‡ä»¶ä¸¢å¤±
**A**: ç¡®ä¿ä½¿ç”¨ç»‘å®šæŒ‚è½½è€Œä¸æ˜¯åŒ¿åå·

### Q2: æƒé™æ‹’ç»é”™è¯¯
**A**: æ£€æŸ¥å®¿ä¸»æœºç›®å½•æƒé™ï¼Œå¿…è¦æ—¶ä½¿ç”¨ `chmod 777`

### Q3: è·¯å¾„ä¸åŒ¹é…
**A**: ç¡®è®¤ç¯å¢ƒå˜é‡ `UPLOAD_DIR` é…ç½®æ­£ç¡®

## ğŸ“ åç»­ä¼˜åŒ–

1. **æ·»åŠ æ–‡ä»¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º**
2. **å®ç°æ–‡ä»¶å»é‡æœºåˆ¶**
3. **æ·»åŠ æ–‡ä»¶ç±»å‹å’Œå¤§å°éªŒè¯**
4. **ä¼˜åŒ–é”™è¯¯æç¤ºä¿¡æ¯**
5. **æ·»åŠ æ–‡ä»¶æ¸…ç†å®šæ—¶ä»»åŠ¡**
