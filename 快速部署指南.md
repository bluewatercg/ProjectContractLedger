# å®¢æˆ·åˆåŒç®¡ç†ç³»ç»Ÿ - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸš€ ä¸€é”®éƒ¨ç½²

æœ¬ç³»ç»Ÿé‡‡ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºï¼Œæ”¯æŒå¤–éƒ¨MySQLå’ŒRedisçš„ç®€åŒ–éƒ¨ç½²æ–¹æ¡ˆã€‚

### å‰ææ¡ä»¶
- âœ… Docker å’Œ Docker Compose
- âœ… å¤–éƒ¨MySQLæœåŠ¡å™¨
- âœ… å¤–éƒ¨RedisæœåŠ¡å™¨

### å¿«é€Ÿå¼€å§‹

#### 1. ä¸‹è½½éƒ¨ç½²è„šæœ¬
```bash
wget https://raw.githubusercontent.com/bluewatercg/projectcontractledger/main/deploy-simple.sh
chmod +x deploy-simple.sh
```

#### 2. åˆå§‹åŒ–éƒ¨ç½²ç¯å¢ƒ
```bash
./deploy-simple.sh --init
```

#### 3. é…ç½®æ•°æ®åº“ä¿¡æ¯
ç¼–è¾‘ `.env.external-simple` æ–‡ä»¶ï¼š
```bash
# ç¯å¢ƒæ ‡è¯†
NODE_ENV=production

# å¿…å¡«é¡¹
DB_HOST=your-mysql-host
DB_USERNAME=your-mysql-username
DB_PASSWORD=your-mysql-password
DB_DATABASE=your-mysql-database

REDIS_HOST=your-redis-host
REDIS_PASSWORD=your-redis-password

JWT_SECRET=your-super-secret-jwt-key-at-least-32-characters-long
```

**é…ç½®è¯´æ˜**ï¼š
- æ‰€æœ‰ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ä½¿ç”¨ç›¸åŒçš„é…ç½®ç»“æ„
- åªéœ€è¦ä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯å’Œç¯å¢ƒæ ‡å¿—
- ä¸åŒç¯å¢ƒå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“åç§°å’ŒRedisæ•°æ®åº“ç¼–å·

#### 4. å¯åŠ¨æœåŠ¡
```bash
./deploy-simple.sh
```

#### 5. è®¿é—®åº”ç”¨
- å‰ç«¯: http://your-server-ip
- åç«¯API: http://your-server-ip:8080
- APIæ–‡æ¡£: http://your-server-ip/api-docs

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy-simple.sh --status

# æŸ¥çœ‹æ—¥å¿—
./deploy-simple.sh --logs

# é‡å¯æœåŠ¡
./deploy-simple.sh --restart

# åœæ­¢æœåŠ¡
./deploy-simple.sh --stop

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
./deploy-simple.sh --pull
./deploy-simple.sh --restart
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®
| å˜é‡å | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| NODE_ENV | âœ… | production | ç¯å¢ƒæ ‡è¯† (local/unittest/production) |
| DB_HOST | âœ… | - | MySQLæœåŠ¡å™¨åœ°å€ |
| DB_PORT | âŒ | 3306 | MySQLç«¯å£ |
| DB_USERNAME | âœ… | - | MySQLç”¨æˆ·å |
| DB_PASSWORD | âœ… | - | MySQLå¯†ç  |
| DB_DATABASE | âœ… | - | MySQLæ•°æ®åº“å |
| DB_POOL_SIZE | âŒ | 10 | æ•°æ®åº“è¿æ¥æ± å¤§å° |
| REDIS_HOST | âœ… | - | RedisæœåŠ¡å™¨åœ°å€ |
| REDIS_PORT | âŒ | 6379 | Redisç«¯å£ |
| REDIS_PASSWORD | âŒ | - | Rediså¯†ç  |
| REDIS_DB | âŒ | 0 | Redisæ•°æ®åº“ç¼–å· |
| JWT_SECRET | âœ… | - | JWTå¯†é’¥ï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰ |
| JWT_EXPIRES_IN | âŒ | 24h | JWTè¿‡æœŸæ—¶é—´ |
| FRONTEND_HTTP_PORT | âŒ | 80 | å‰ç«¯ç«¯å£ |
| BACKEND_PORT | âŒ | 8080 | åç«¯ç«¯å£ |
| LOG_LEVEL | âŒ | info | æ—¥å¿—çº§åˆ« |
| CORS_ORIGINS | âŒ | * | è·¨åŸŸé…ç½® |

**ç¯å¢ƒé…ç½®æ¨¡æ¿**ï¼š
- **å¼€å‘ç¯å¢ƒ**: `.env.local.template` â†’ `.env.local`
- **æµ‹è¯•ç¯å¢ƒ**: `.env.unittest.template` â†’ `.env.unittest`
- **ç”Ÿäº§ç¯å¢ƒ**: `.env.external-simple.template` â†’ `.env.external-simple`

### ç«¯å£è¯´æ˜
- **80**: å‰ç«¯Webç•Œé¢
- **8080**: åç«¯APIæœåŠ¡

## ğŸ—ï¸ æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ (Vue3)   â”‚    â”‚  åç«¯ (Midway)  â”‚
â”‚     :80         â”‚â—„â”€â”€â–ºâ”‚     :8080       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Docker å®¹å™¨    â”‚
            â”‚  (å•ä¸€é•œåƒ)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ å¤–éƒ¨ MySQL   â”‚ â”‚ å¤–éƒ¨   â”‚ â”‚ GitHub   â”‚
â”‚ æ•°æ®åº“       â”‚ â”‚ Redis  â”‚ â”‚ Registry â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. é•œåƒæ‹‰å–å¤±è´¥
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping ghcr.io

# æ‰‹åŠ¨æ‹‰å–é•œåƒ
docker pull ghcr.io/bluewatercg/projectcontractledger:latest

# å¦‚æœæ‹‰å–å¤±è´¥ï¼Œæ£€æŸ¥GitHub Actionsæ„å»ºçŠ¶æ€
# è®¿é—®: https://github.com/bluewatercg/projectcontractledger/actions
```

#### 1. GitHub Actionsæ„å»ºå¤±è´¥
å¦‚æœé•œåƒæ‹‰å–å¤±è´¥ï¼Œé¦–å…ˆæ£€æŸ¥GitHub Actionsæ„å»ºçŠ¶æ€ï¼š

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. è®¿é—®: https://github.com/bluewatercg/projectcontractledger/actions
2. æŸ¥çœ‹æœ€æ–°çš„æ„å»ºæ—¥å¿—
3. ç¡®è®¤æ„å»ºæ˜¯å¦æˆåŠŸå®Œæˆ

**å¸¸è§æ„å»ºå¤±è´¥åŸå› ï¼š**
- **ä»£ç æ ¼å¼é—®é¢˜**ï¼šESLint/Prettieræ ¼å¼æ£€æŸ¥å¤±è´¥
- **å‰ç«¯æ„å»ºå¤±è´¥**ï¼šä¾èµ–ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
- **åç«¯æ„å»ºå¤±è´¥**ï¼šTypeScripté…ç½®é—®é¢˜
- **å†…å­˜ä¸è¶³**ï¼šGitHub Actionsæœ‰å†…å­˜é™åˆ¶
- **ç½‘ç»œè¶…æ—¶**ï¼šä¾èµ–ä¸‹è½½å¤±è´¥

**è§£å†³æ–¹æ³•ï¼š**
```bash
# å¦‚æœæ˜¯ä»£ç æ ¼å¼é—®é¢˜ï¼Œå¯ä»¥æœ¬åœ°ä¿®å¤åé‡æ–°æäº¤
# Linux/Mac:
chmod +x fix-format.sh
./fix-format.sh

# Windows:
fix-format.bat

# ç„¶åé‡æ–°æäº¤ä»£ç 
git add .
git commit -m "fix: ä¿®å¤ä»£ç æ ¼å¼é—®é¢˜"
git push
```

- ç­‰å¾…è‡ªåŠ¨é‡è¯•æˆ–æ‰‹åŠ¨é‡æ–°è§¦å‘æ„å»º
- æ£€æŸ¥ä»£ç æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
- æŸ¥çœ‹å…·ä½“çš„é”™è¯¯æ—¥å¿—ä¿¡æ¯

#### 2. é•œåƒæ‹‰å–å¤±è´¥
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping ghcr.io

# æ£€æŸ¥Dockeræ˜¯å¦æ­£å¸¸è¿è¡Œ
docker version

# æ‰‹åŠ¨æ‹‰å–é•œåƒ
docker pull ghcr.io/bluewatercg/projectcontractledger:latest
```

#### 3. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -h your-mysql-host -u your-username -p

# æ£€æŸ¥é…ç½®
cat .env.external-simple | grep DB_
```

#### 4. Redisè¿æ¥å¤±è´¥
```bash
# æµ‹è¯•Redisè¿æ¥
redis-cli -h your-redis-host -p 6379

# æ£€æŸ¥é…ç½®
cat .env.external-simple | grep REDIS_
```

#### 5. æœåŠ¡æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :80
netstat -tlnp | grep :8080

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# å®æ—¶æ—¥å¿—
./deploy-simple.sh --logs

# å†å²æ—¥å¿—
docker logs contract-ledger-app-simple

# ç‰¹å®šæ—¶é—´æ—¥å¿—
docker logs --since="2024-01-01T00:00:00" contract-ledger-app-simple
```

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### è‡ªåŠ¨æ›´æ–°
å½“GitHubä»“åº“æœ‰æ–°æäº¤æ—¶ï¼Œé•œåƒä¼šè‡ªåŠ¨æ„å»ºã€‚æ›´æ–°æ­¥éª¤ï¼š

```bash
# æ‹‰å–æœ€æ–°é•œåƒ
./deploy-simple.sh --pull

# é‡å¯æœåŠ¡
./deploy-simple.sh --restart
```

### ç‰ˆæœ¬å›æ»š
```bash
# åœ¨.env.external-simpleä¸­æŒ‡å®šç‰ˆæœ¬
IMAGE_TAG=v1.0.0

# é‡æ–°éƒ¨ç½²
./deploy-simple.sh --restart
```

## ğŸ“Š ç›‘æ§æ£€æŸ¥

### å¥åº·æ£€æŸ¥
```bash
# æœåŠ¡çŠ¶æ€
./deploy-simple.sh --status

# æ‰‹åŠ¨æ£€æŸ¥
curl http://localhost/health
curl http://localhost:8080/health
```

### æ€§èƒ½ç›‘æ§
```bash
# å®¹å™¨èµ„æºä½¿ç”¨
docker stats contract-ledger-app-simple

# ç³»ç»Ÿèµ„æº
htop
df -h
```

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤ç«¯å£**ï¼ˆå¯é€‰ï¼‰
2. **é…ç½®é˜²ç«å¢™è§„åˆ™**
3. **ä½¿ç”¨å¼ºå¯†ç **
4. **å®šæœŸæ›´æ–°ç³»ç»Ÿ**
5. **é…ç½®HTTPS**ï¼ˆæ¨èä½¿ç”¨åå‘ä»£ç†ï¼‰

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- æ“ä½œç³»ç»Ÿç‰ˆæœ¬
- Dockerç‰ˆæœ¬
- é”™è¯¯æ—¥å¿—
- é…ç½®æ–‡ä»¶ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰

---

**æ³¨æ„**: æœ¬æŒ‡å—é€‚ç”¨äºå¤–éƒ¨MySQLå’ŒRedisçš„ç®€åŒ–éƒ¨ç½²æ–¹æ¡ˆã€‚å¦‚éœ€å…¶ä»–éƒ¨ç½²æ–¹å¼ï¼Œè¯·å‚è€ƒå®Œæ•´éƒ¨ç½²æ–‡æ¡£ã€‚
