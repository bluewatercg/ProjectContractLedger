/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                        *//* empty css                 *//* empty css                     */import{d as R,r as _,x as C,a as M,o as T,c as $,b as i,t as D,N as L,L as P,w as r,h as Y,i as j,n as E,E as A,P as O,l as N,e as o,g as k,q as X,p as z,X as G,Y as H,v as J}from"./index-1e642474.js";import{c as f}from"./contract-f9d1be3d.js";import{C as K}from"./CustomerSelect-f45417da.js";/* empty css               *//* empty css                  */import"./customer-5d58a403.js";import"./_plugin-vue_export-helper-c27b6911.js";const Q={class:"page-container"},W={class:"page-header"},Z={class:"page-title"},ee={class:"form-container"},te={class:"form-actions"},ge=R({__name:"ContractForm",setup(ae){const g=Y(),V=j(),m=_(),c=_(!1),u=_(!1),d=C(()=>!!V.params.id),v=C(()=>Number(V.params.id)),t=M({customer_id:0,title:"",description:"",total_amount:0,start_date:"",end_date:"",terms:"",notes:""}),x={customer_id:[{required:!0,message:"请选择客户",trigger:"change"}],title:[{required:!0,message:"请输入合同标题",trigger:"blur"}],total_amount:[{required:!0,message:"请输入合同金额",trigger:"blur"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}]},U=(a,e)=>{t.customer_id=a||0,console.log("Selected customer:",e)},y=a=>{if(!a)return null;const e=new Date(a);return isNaN(e.getTime())?null:e},B=async()=>{if(d.value)try{c.value=!0;const a=await f.getContractById(v.value);if(a.success&&a.data){const e=a.data;Object.assign(t,{...e,start_date:y(e.start_date),end_date:y(e.end_date)})}}catch(a){console.error("Failed to fetch contract:",a),E.error("获取合同信息失败")}finally{c.value=!1}},b=a=>{if(!a)return"";const e=new Date(a);if(isNaN(e.getTime()))return"";const s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${s}-${n}-${p}`},S=async()=>{if(m.value)try{await m.value.validate(),u.value=!0;const a={...t,start_date:b(t.start_date),end_date:b(t.end_date)};let e;d.value?e=await f.updateContract(v.value,a):e=await f.createContract(a),e.success&&(E.success(d.value?"更新成功":"创建成功"),g.push("/contracts"))}catch(a){console.error("Failed to submit form:",a)}finally{u.value=!1}},q=()=>{g.go(-1)};return T(async()=>{d.value&&await B()}),(a,e)=>{const s=X,n=z,p=G,h=H,w=J,F=A,I=O;return N(),$("div",Q,[i("div",W,[i("h2",Z,D(d.value?"编辑合同":"新建合同"),1)]),i("div",ee,[L((N(),P(F,{ref_key:"formRef",ref:m,model:t,rules:x,"label-width":"100px"},{default:r(()=>[o(s,{label:"客户",prop:"customer_id"},{default:r(()=>[o(K,{modelValue:t.customer_id,"onUpdate:modelValue":e[0]||(e[0]=l=>t.customer_id=l),placeholder:"请选择客户（支持搜索）",onChange:U},null,8,["modelValue"])]),_:1}),o(s,{label:"合同标题",prop:"title"},{default:r(()=>[o(n,{modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=l=>t.title=l),placeholder:"请输入合同标题"},null,8,["modelValue"])]),_:1}),o(s,{label:"合同描述",prop:"description"},{default:r(()=>[o(n,{modelValue:t.description,"onUpdate:modelValue":e[2]||(e[2]=l=>t.description=l),type:"textarea",rows:4,placeholder:"请输入合同描述"},null,8,["modelValue"])]),_:1}),o(s,{label:"合同金额",prop:"total_amount"},{default:r(()=>[o(p,{modelValue:t.total_amount,"onUpdate:modelValue":e[3]||(e[3]=l=>t.total_amount=l),min:0,precision:2,style:{width:"100%"},placeholder:"请输入合同金额"},null,8,["modelValue"])]),_:1}),o(s,{label:"开始日期",prop:"start_date"},{default:r(()=>[o(h,{modelValue:t.start_date,"onUpdate:modelValue":e[4]||(e[4]=l=>t.start_date=l),type:"date",placeholder:"请选择开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(s,{label:"结束日期",prop:"end_date"},{default:r(()=>[o(h,{modelValue:t.end_date,"onUpdate:modelValue":e[5]||(e[5]=l=>t.end_date=l),type:"date",placeholder:"请选择结束日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(s,{label:"合同条款",prop:"terms"},{default:r(()=>[o(n,{modelValue:t.terms,"onUpdate:modelValue":e[6]||(e[6]=l=>t.terms=l),type:"textarea",rows:6,placeholder:"请输入合同条款"},null,8,["modelValue"])]),_:1}),o(s,{label:"备注",prop:"notes"},{default:r(()=>[o(n,{modelValue:t.notes,"onUpdate:modelValue":e[7]||(e[7]=l=>t.notes=l),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1}),i("div",te,[o(w,{onClick:q},{default:r(()=>e[8]||(e[8]=[k("取消")])),_:1,__:[8]}),o(w,{type:"primary",loading:u.value,onClick:S},{default:r(()=>[k(D(u.value?"保存中...":"保存"),1)]),_:1},8,["loading"])])]),_:1},8,["model"])),[[I,c.value]])])])}}});export{ge as default};
