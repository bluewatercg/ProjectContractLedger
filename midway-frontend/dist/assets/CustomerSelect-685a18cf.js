/* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{d as N,r as n,$ as k,L as d,w as u,a0 as U,z as A,Q as O,l as i,c as B,Y as P,X as W,b as h,e as D,f as K,M as S,g as Q,T as X,F as Y,t as b}from"./index-16731161.js";import{c as I}from"./customer-00c7240a.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";const j={class:"customer-option"},q={class:"customer-name"},G={class:"customer-info"},H={key:1},J=10,R=N({__name:"CustomerSelect",props:{modelValue:{},placeholder:{default:"请选择客户"},width:{default:"100%"},disabled:{type:Boolean,default:!1},onlyWithUnpaidInvoices:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(z,{emit:M}){const c=z,w=M,m=n(c.modelValue||null),t=n([]),p=n(!1),v=n(!1),y=n(""),g=n(1),f=n(!0);let C=null;k(()=>c.modelValue,async e=>{m.value=e||null,e&&!t.value.find(a=>a.id===e)&&await x(e)}),k(m,e=>{w("update:modelValue",e)});const x=async e=>{try{const a=await I.getCustomerById(e);if(a.success&&a.data){const l=t.value.findIndex(o=>o.id===e);l===-1?t.value.unshift(a.data):t.value[l]=a.data}}catch(a){console.error("Failed to load customer by id:",a)}},V=async(e="",a=1,l=!1)=>{try{a===1?p.value=!0:v.value=!0;const o={page:a,limit:J,search:e.trim(),sortBy:"name",sortOrder:"ASC"};c.onlyWithUnpaidInvoices&&(o.hasUnpaidInvoices=!0);const r=await I.getCustomers(o);if(r.success&&r.data){const _=r.data.items;l?t.value=[...t.value,..._]:t.value=_,g.value=a,f.value=a<r.data.totalPages}}catch(o){console.error("Failed to search customers:",o)}finally{p.value=!1,v.value=!1}},T=e=>{y.value=e,C&&clearTimeout(C),C=setTimeout(()=>{g.value=1,f.value=!0,V(e,1,!1)},300)},E=async()=>{f.value&&!v.value&&await V(y.value,g.value+1,!0)},F=e=>{const a=t.value.find(l=>l.id===e)||null;w("change",e,a)},L=async e=>{e&&t.value.length===0&&await V("",1,!1)};return(async()=>{c.modelValue&&await x(c.modelValue)})(),(e,a)=>{const l=X,o=A("Loading"),r=Y,_=O;return i(),d(_,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=s=>m.value=s),placeholder:e.placeholder,style:U({width:e.width}),filterable:"",remote:"","reserve-keyword":"","remote-method":T,loading:p.value,clearable:"",onChange:F,onVisibleChange:L},{default:u(()=>[(i(!0),B(W,null,P(t.value,s=>(i(),d(l,{key:s.id,label:s.name,value:s.id},{default:u(()=>[h("div",j,[h("div",q,b(s.name),1),h("div",G,b(s.contact_person)+" | "+b(s.phone),1)])]),_:2},1032,["label","value"]))),128)),f.value&&t.value.length>0?(i(),d(l,{key:0,value:"loading",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>[h("div",{onClick:K(E,["stop"]),style:{cursor:"pointer",padding:"8px"}},[v.value?(i(),d(r,{key:0},{default:u(()=>[D(o)]),_:1})):(i(),B("span",H,"点击加载更多..."))])]),_:1})):S("",!0),!p.value&&t.value.length===0&&y.value?(i(),d(l,{key:1,value:"no-data",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>a[1]||(a[1]=[Q(" 未找到相关客户 ")])),_:1,__:[1]})):S("",!0)]),_:1},8,["modelValue","placeholder","style","loading"])}}});const ie=$(R,[["__scopeId","data-v-663175b4"]]);export{ie as C};
