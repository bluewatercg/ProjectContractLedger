/* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{d as N,r as n,$ as x,L as i,w as c,a0 as A,z as O,Q as P,l as r,c as k,Y as D,X as K,b as _,e as Q,f as U,M as S,g as X,T as Y,F as $,t as V}from"./index-3fea3ed3.js";import{c as B}from"./customer-8509e1c5.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";const q={class:"customer-option"},G={class:"customer-name"},H={class:"customer-info"},J={key:1},R=10,W=N({__name:"CustomerSelect",props:{modelValue:{},placeholder:{default:"请选择客户"},width:{default:"100%"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(z,{emit:I}){const d=z,w=I,u=n(d.modelValue||null),t=n([]),m=n(!1),f=n(!1),h=n(""),y=n(1),v=n(!0);let g=null;x(()=>d.modelValue,async e=>{u.value=e||null,e&&!t.value.find(a=>a.id===e)&&await b(e)}),x(u,e=>{w("update:modelValue",e)});const b=async e=>{try{const a=await B.getCustomerById(e);if(a.success&&a.data){const l=t.value.findIndex(o=>o.id===e);l===-1?t.value.unshift(a.data):t.value[l]=a.data}}catch(a){console.error("Failed to load customer by id:",a)}},C=async(e="",a=1,l=!1)=>{try{a===1?m.value=!0:f.value=!0;const o=await B.getCustomers({page:a,limit:R,search:e.trim(),sortBy:"name",sortOrder:"ASC"});if(o.success&&o.data){const p=o.data.items;l?t.value=[...t.value,...p]:t.value=p,y.value=a,v.value=a<o.data.totalPages}}catch(o){console.error("Failed to search customers:",o)}finally{m.value=!1,f.value=!1}},M=e=>{h.value=e,g&&clearTimeout(g),g=setTimeout(()=>{y.value=1,v.value=!0,C(e,1,!1)},300)},T=async()=>{v.value&&!f.value&&await C(h.value,y.value+1,!0)},E=e=>{const a=t.value.find(l=>l.id===e)||null;w("change",e,a)},F=async e=>{e&&t.value.length===0&&await C("",1,!1)};return(async()=>{d.modelValue&&await b(d.modelValue)})(),(e,a)=>{const l=Y,o=O("Loading"),p=$,L=P;return r(),i(L,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=s=>u.value=s),placeholder:e.placeholder,style:A({width:e.width}),filterable:"",remote:"","reserve-keyword":"","remote-method":M,loading:m.value,clearable:"",onChange:E,onVisibleChange:F},{default:c(()=>[(r(!0),k(K,null,D(t.value,s=>(r(),i(l,{key:s.id,label:s.name,value:s.id},{default:c(()=>[_("div",q,[_("div",G,V(s.name),1),_("div",H,V(s.contact_person)+" | "+V(s.phone),1)])]),_:2},1032,["label","value"]))),128)),v.value&&t.value.length>0?(r(),i(l,{key:0,value:"loading",disabled:"",style:{"text-align":"center",color:"#999"}},{default:c(()=>[_("div",{onClick:U(T,["stop"]),style:{cursor:"pointer",padding:"8px"}},[f.value?(r(),i(p,{key:0},{default:c(()=>[Q(o)]),_:1})):(r(),k("span",J,"点击加载更多..."))])]),_:1})):S("",!0),!m.value&&t.value.length===0&&h.value?(r(),i(l,{key:1,value:"no-data",disabled:"",style:{"text-align":"center",color:"#999"}},{default:c(()=>a[1]||(a[1]=[X(" 未找到相关客户 ")])),_:1,__:[1]})):S("",!0)]),_:1},8,["modelValue","placeholder","style","loading"])}}});const re=j(W,[["__scopeId","data-v-0a0ef5fa"]]);export{re as C};
