/* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{d as O,r as i,$ as x,L as d,w as u,a0 as P,z as A,Q as K,l as c,c as S,Y as Q,X as U,b as h,e as X,f as Y,M as k,g as $,T as j,F as q,t as V}from"./index-16731161.js";import{i as B}from"./invoice-9db49e33.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";const H={class:"invoice-option"},J={class:"invoice-number"},R={class:"invoice-info"},W={key:1},Z=10,ee=O({__name:"InvoiceSelect",props:{modelValue:{},placeholder:{default:"请选择发票"},width:{default:"100%"},disabled:{type:Boolean,default:!1},contractId:{},customerId:{},status:{}},emits:["update:modelValue","change"],setup(M,{emit:z}){const o=M,w=z,m=i(o.modelValue||null),a=i([]),v=i(!1),f=i(!1),y=i(""),g=i(1),p=i(!0);let I=null;const N=e=>new Intl.NumberFormat("zh-CN").format(e),T=e=>({draft:"草稿",sent:"已发送",paid:"已支付",overdue:"逾期",cancelled:"已取消"})[e]||e;x(()=>o.modelValue,async e=>{m.value=e||null,e&&!a.value.find(t=>t.id===e)&&await C(e)}),x(m,e=>{w("update:modelValue",e)});const C=async e=>{try{const t=await B.getInvoiceById(e);if(t.success&&t.data){const l=a.value.findIndex(s=>s.id===e);l===-1?a.value.unshift(t.data):a.value[l]=t.data}}catch(t){console.error("Failed to load invoice by id:",t)}},b=async(e="",t=1,l=!1)=>{try{t===1?v.value=!0:f.value=!0;const s={page:t,limit:Z,search:e.trim(),sortBy:"created_at",sortOrder:"DESC"};o.contractId&&(s.contractId=o.contractId),o.customerId&&(s.customerId=o.customerId),o.status&&(s.status=o.status);const r=await B.getInvoices(s);if(r.success&&r.data){const _=r.data.items;l?a.value=[...a.value,..._]:a.value=_,g.value=t,p.value=t<r.data.totalPages}}catch(s){console.error("Failed to search invoices:",s)}finally{v.value=!1,f.value=!1}},E=e=>{y.value=e,I&&clearTimeout(I),I=setTimeout(()=>{g.value=1,p.value=!0,b(e,1,!1)},300)},F=async()=>{p.value&&!f.value&&await b(y.value,g.value+1,!0)},L=e=>{const t=a.value.find(l=>l.id===e)||null;w("change",e,t)},D=async e=>{e&&a.value.length===0&&await b("",1,!1)};return(async()=>{o.modelValue&&await C(o.modelValue)})(),(e,t)=>{const l=j,s=A("Loading"),r=q,_=K;return c(),d(_,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=n=>m.value=n),placeholder:e.placeholder,style:P({width:e.width}),filterable:"",remote:"","reserve-keyword":"","remote-method":E,loading:v.value,clearable:"",onChange:L,onVisibleChange:D},{default:u(()=>[(c(!0),S(U,null,Q(a.value,n=>(c(),d(l,{key:n.id,label:n.invoice_number,value:n.id},{default:u(()=>[h("div",H,[h("div",J,V(n.invoice_number),1),h("div",R,"¥"+V(N(n.amount))+" | "+V(T(n.status)),1)])]),_:2},1032,["label","value"]))),128)),p.value&&a.value.length>0?(c(),d(l,{key:0,value:"loading",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>[h("div",{onClick:Y(F,["stop"]),style:{cursor:"pointer",padding:"8px"}},[f.value?(c(),d(r,{key:0},{default:u(()=>[X(s)]),_:1})):(c(),S("span",W,"点击加载更多..."))])]),_:1})):k("",!0),!v.value&&a.value.length===0&&y.value?(c(),d(l,{key:1,value:"no-data",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>t[1]||(t[1]=[$(" 未找到相关发票 ")])),_:1,__:[1]})):k("",!0)]),_:1},8,["modelValue","placeholder","style","loading"])}}});const re=G(ee,[["__scopeId","data-v-f280fe3d"]]);export{re as I};
