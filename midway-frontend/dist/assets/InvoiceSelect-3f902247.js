/* empty css                  *//* empty css               *//* empty css                  *//* empty css                     */import{d as O,r as i,Z as x,L as d,w as u,_ as P,z as A,Q as K,l as c,c as S,$ as Q,a0 as U,b as h,e as Z,f as $,M as k,g as j,T as q,F as G,t as V}from"./index-1e642474.js";import{i as B}from"./invoice-657a2ee3.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";const J={class:"invoice-option"},R={class:"invoice-number"},W={class:"invoice-info"},X={key:1},Y=10,ee=O({__name:"InvoiceSelect",props:{modelValue:{},placeholder:{default:"请选择发票"},width:{default:"100%"},disabled:{type:Boolean,default:!1},contractId:{},status:{}},emits:["update:modelValue","change"],setup(M,{emit:z}){const s=M,w=z,v=i(s.modelValue||null),t=i([]),m=i(!1),f=i(!1),y=i(""),g=i(1),p=i(!0);let b=null;const N=e=>new Intl.NumberFormat("zh-CN").format(e),T=e=>({draft:"草稿",sent:"已发送",paid:"已支付",overdue:"逾期",cancelled:"已取消"})[e]||e;x(()=>s.modelValue,async e=>{v.value=e||null,e&&!t.value.find(a=>a.id===e)&&await C(e)}),x(v,e=>{w("update:modelValue",e)});const C=async e=>{try{const a=await B.getInvoiceById(e);if(a.success&&a.data){const o=t.value.findIndex(l=>l.id===e);o===-1?t.value.unshift(a.data):t.value[o]=a.data}}catch(a){console.error("Failed to load invoice by id:",a)}},I=async(e="",a=1,o=!1)=>{try{a===1?m.value=!0:f.value=!0;const l={page:a,limit:Y,search:e.trim(),sortBy:"created_at",sortOrder:"DESC"};s.contractId&&(l.contractId=s.contractId),s.status&&(l.status=s.status);const r=await B.getInvoices(l);if(r.success&&r.data){const _=r.data.items;o?t.value=[...t.value,..._]:t.value=_,g.value=a,p.value=a<r.data.totalPages}}catch(l){console.error("Failed to search invoices:",l)}finally{m.value=!1,f.value=!1}},E=e=>{y.value=e,b&&clearTimeout(b),b=setTimeout(()=>{g.value=1,p.value=!0,I(e,1,!1)},300)},F=async()=>{p.value&&!f.value&&await I(y.value,g.value+1,!0)},L=e=>{const a=t.value.find(o=>o.id===e)||null;w("change",e,a)},D=async e=>{e&&t.value.length===0&&await I("",1,!1)};return(async()=>{s.modelValue&&await C(s.modelValue)})(),(e,a)=>{const o=q,l=A("Loading"),r=G,_=K;return c(),d(_,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=n=>v.value=n),placeholder:e.placeholder,style:P({width:e.width}),filterable:"",remote:"","reserve-keyword":"","remote-method":E,loading:m.value,clearable:"",onChange:L,onVisibleChange:D},{default:u(()=>[(c(!0),S(U,null,Q(t.value,n=>(c(),d(o,{key:n.id,label:n.invoice_number,value:n.id},{default:u(()=>[h("div",J,[h("div",R,V(n.invoice_number),1),h("div",W,"¥"+V(N(n.amount))+" | "+V(T(n.status)),1)])]),_:2},1032,["label","value"]))),128)),p.value&&t.value.length>0?(c(),d(o,{key:0,value:"loading",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>[h("div",{onClick:$(F,["stop"]),style:{cursor:"pointer",padding:"8px"}},[f.value?(c(),d(r,{key:0},{default:u(()=>[Z(l)]),_:1})):(c(),S("span",X,"点击加载更多..."))])]),_:1})):k("",!0),!m.value&&t.value.length===0&&y.value?(c(),d(o,{key:1,value:"no-data",disabled:"",style:{"text-align":"center",color:"#999"}},{default:u(()=>a[1]||(a[1]=[j(" 未找到相关发票 ")])),_:1,__:[1]})):k("",!0)]),_:1},8,["modelValue","placeholder","style","loading"])}}});const re=H(ee,[["__scopeId","data-v-7b255b33"]]);export{re as I};
