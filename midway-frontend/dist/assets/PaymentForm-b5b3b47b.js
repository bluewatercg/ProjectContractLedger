/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        */import{d as T,r as f,x as w,a as M,o as $,c as L,b as u,t as k,N as O,L as Y,w as l,h as j,i as A,n as E,E as Q,P as X,l as D,e as a,g as N,q as z,X as G,Y as H,T as J,Q as K,p as W,v as Z}from"./index-1e642474.js";import{p as y}from"./payment-3e777d45.js";import{I as ee}from"./InvoiceSelect-3f902247.js";import"./invoice-657a2ee3.js";import"./_plugin-vue_export-helper-c27b6911.js";const te={class:"page-container"},ae={class:"page-header"},oe={class:"page-title"},ne={class:"form-container"},le={class:"form-actions"},he=T({__name:"PaymentForm",setup(re){const g=j(),v=A(),d=f(),p=f(!1),m=f(!1),s=w(()=>!!v.params.id),b=w(()=>Number(v.params.id)),o=M({invoice_id:0,amount:0,payment_date:"",payment_method:"bank_transfer",reference_number:"",notes:""}),I={invoice_id:[{required:!0,message:"请选择发票",trigger:"change"}],amount:[{required:!0,message:"请输入支付金额",trigger:"blur"}],payment_date:[{required:!0,message:"请选择支付日期",trigger:"change"}],payment_method:[{required:!0,message:"请选择支付方式",trigger:"change"}]},S=(t,e)=>{o.invoice_id=t||0,console.log("Selected invoice:",e)},x=t=>{if(!t)return"";const e=new Date(t);if(isNaN(e.getTime()))return"";const r=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),_=String(e.getDate()).padStart(2,"0");return`${r}-${c}-${_}`},B=t=>{if(!t)return null;const e=new Date(t);return isNaN(e.getTime())?null:e},P=async()=>{if(s.value)try{p.value=!0;const t=await y.getPaymentById(b.value);if(t.success&&t.data){const e=t.data;Object.assign(o,{...e,payment_date:B(e.payment_date)})}}catch(t){console.error("Failed to fetch payment:",t),E.error("获取支付记录失败")}finally{p.value=!1}},C=async()=>{if(d.value)try{await d.value.validate(),m.value=!0;const t={...o,payment_date:x(o.payment_date)};let e;s.value?e=await y.updatePayment(b.value,t):e=await y.createPayment(t),e.success&&(E.success(s.value?"更新成功":"创建成功"),g.push("/payments"))}catch(t){console.error("Failed to submit form:",t)}finally{m.value=!1}},F=()=>{g.go(-1)};return $(()=>{s.value&&P()}),(t,e)=>{const r=z,c=G,_=H,i=J,U=K,h=W,V=Z,q=Q,R=X;return D(),L("div",te,[u("div",ae,[u("h2",oe,k(s.value?"编辑支付":"新建支付"),1)]),u("div",ne,[O((D(),Y(q,{ref_key:"formRef",ref:d,model:o,rules:I,"label-width":"100px"},{default:l(()=>[a(r,{label:"发票",prop:"invoice_id"},{default:l(()=>[a(ee,{modelValue:o.invoice_id,"onUpdate:modelValue":e[0]||(e[0]=n=>o.invoice_id=n),placeholder:"请选择发票（支持搜索）",onChange:S},null,8,["modelValue"])]),_:1}),a(r,{label:"支付金额",prop:"amount"},{default:l(()=>[a(c,{modelValue:o.amount,"onUpdate:modelValue":e[1]||(e[1]=n=>o.amount=n),min:0,precision:2,style:{width:"100%"},placeholder:"请输入支付金额"},null,8,["modelValue"])]),_:1}),a(r,{label:"支付日期",prop:"payment_date"},{default:l(()=>[a(_,{modelValue:o.payment_date,"onUpdate:modelValue":e[2]||(e[2]=n=>o.payment_date=n),type:"date",placeholder:"请选择支付日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(r,{label:"支付方式",prop:"payment_method"},{default:l(()=>[a(U,{modelValue:o.payment_method,"onUpdate:modelValue":e[3]||(e[3]=n=>o.payment_method=n),placeholder:"请选择支付方式",style:{width:"100%"}},{default:l(()=>[a(i,{label:"现金",value:"cash"}),a(i,{label:"银行转账",value:"bank_transfer"}),a(i,{label:"支票",value:"check"}),a(i,{label:"信用卡",value:"credit_card"}),a(i,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"参考号",prop:"reference_number"},{default:l(()=>[a(h,{modelValue:o.reference_number,"onUpdate:modelValue":e[4]||(e[4]=n=>o.reference_number=n),placeholder:"请输入参考号或交易号"},null,8,["modelValue"])]),_:1}),a(r,{label:"备注",prop:"notes"},{default:l(()=>[a(h,{modelValue:o.notes,"onUpdate:modelValue":e[5]||(e[5]=n=>o.notes=n),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1}),u("div",le,[a(V,{onClick:F},{default:l(()=>e[6]||(e[6]=[N("取消")])),_:1,__:[6]}),a(V,{type:"primary",loading:m.value,onClick:C},{default:l(()=>[N(k(m.value?"保存中...":"保存"),1)]),_:1},8,["loading"])])]),_:1},8,["model"])),[[R,p.value]])])])}}});export{he as default};
