/* empty css                  *//* empty css                   *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css                             */import{d as W,r as x,x as j,o as q,c as v,b as r,e as t,w as e,N as G,L as H,M,h as J,i as K,n as Q,v as X,V as Y,a1 as Z,R as tt,P as et,l as p,g as o,t as n,W as at,O as st,a2 as lt,a3 as ot,U as nt}from"./index-16731161.js";import{i as ut}from"./invoice-9db49e33.js";import{_ as rt}from"./_plugin-vue_export-helper-c27b6911.js";const it={class:"page-container"},dt={class:"page-header"},ct={key:1,class:"mt-6"},mt={class:"payment-summary mb-4"},pt={class:"summary-item"},_t={class:"summary-value total"},vt={class:"summary-item"},ft={class:"summary-value paid"},yt={class:"summary-item"},bt={class:"summary-value unpaid"},gt={key:0},ht={key:1,class:"text-center py-8 text-gray-500"},wt=W({__name:"InvoiceDetail",setup(Ct){const _=J(),I=K(),y=x(!1),l=x(),b=j(()=>Number(I.params.id)),c=s=>new Intl.NumberFormat("zh-CN").format(s),w=s=>new Date(s).toLocaleString("zh-CN"),E=s=>({draft:"info",sent:"warning",paid:"success",overdue:"danger",cancelled:"primary"})[s]||"info",N=s=>({draft:"草稿",sent:"已发送",paid:"已支付",overdue:"逾期",cancelled:"已取消"})[s]||s,D=s=>({cash:"现金",bank_transfer:"银行转账",check:"支票",credit_card:"信用卡",other:"其他"})[s]||s,T=s=>({pending:"warning",completed:"success",failed:"danger"})[s]||"info",P=s=>({pending:"待处理",completed:"已完成",failed:"失败"})[s]||s,C=()=>{var s;return!((s=l.value)!=null&&s.payments)||!Array.isArray(l.value.payments)?0:l.value.payments.filter(a=>a.status==="completed").reduce((a,m)=>a+Number(m.amount),0)},B=()=>l.value?Number(l.value.total_amount)-C():0,S=async()=>{try{y.value=!0;const s=await ut.getInvoiceById(b.value);s.success&&s.data&&(l.value=s.data)}catch(s){console.error("Failed to fetch invoice:",s),Q.error("获取发票信息失败")}finally{y.value=!1}},$=()=>{_.push(`/invoices/${b.value}/edit`)},A=s=>{_.push(`/payments/${s}`)},R=s=>{_.push(`/payments/${s}/edit`)},V=()=>{_.push(`/payments/create?invoiceId=${b.value}`)},z=()=>{_.go(-1)};return q(()=>{S()}),(s,a)=>{const m=X,i=at,k=st,L=Y,g=lt,h=ot,F=Z,d=nt,U=tt,O=et;return p(),v("div",it,[r("div",dt,[a[2]||(a[2]=r("h2",{class:"page-title"},"发票详情",-1)),r("div",null,[t(m,{onClick:z},{default:e(()=>a[0]||(a[0]=[o("返回")])),_:1,__:[0]}),t(m,{type:"primary",onClick:$},{default:e(()=>a[1]||(a[1]=[o("编辑")])),_:1,__:[1]})])]),G((p(),v("div",null,[l.value?(p(),H(L,{key:0,column:2,border:""},{default:e(()=>[t(i,{label:"发票编号"},{default:e(()=>[o(n(l.value.invoice_number),1)]),_:1}),t(i,{label:"合同标题"},{default:e(()=>{var u;return[o(n(((u=l.value.contract)==null?void 0:u.title)||"-"),1)]}),_:1}),t(i,{label:"客户名称"},{default:e(()=>{var u,f;return[o(n(((f=(u=l.value.contract)==null?void 0:u.customer)==null?void 0:f.name)||"-"),1)]}),_:1}),t(i,{label:"发票金额"},{default:e(()=>[o("¥"+n(c(l.value.amount)),1)]),_:1}),t(i,{label:"税率"},{default:e(()=>[o(n(l.value.tax_rate)+"%",1)]),_:1}),t(i,{label:"税额"},{default:e(()=>[o("¥"+n(c(l.value.tax_amount)),1)]),_:1}),t(i,{label:"总金额"},{default:e(()=>[o("¥"+n(c(l.value.total_amount)),1)]),_:1}),t(i,{label:"开票日期"},{default:e(()=>[o(n(l.value.issue_date),1)]),_:1}),t(i,{label:"状态"},{default:e(()=>[t(k,{type:E(l.value.status)},{default:e(()=>[o(n(N(l.value.status)),1)]),_:1},8,["type"])]),_:1}),t(i,{label:"创建时间"},{default:e(()=>[o(n(w(l.value.created_at)),1)]),_:1}),t(i,{label:"发票描述",span:2},{default:e(()=>[o(n(l.value.description||"-"),1)]),_:1}),t(i,{label:"备注",span:2},{default:e(()=>[o(n(l.value.notes||"-"),1)]),_:1})]),_:1})):M("",!0),l.value?(p(),v("div",ct,[a[10]||(a[10]=r("h3",{class:"text-lg font-semibold mb-4"},"支付情况",-1)),r("div",mt,[t(F,{gutter:20},{default:e(()=>[t(h,{span:8},{default:e(()=>[t(g,{class:"summary-card"},{default:e(()=>[r("div",pt,[a[3]||(a[3]=r("div",{class:"summary-label"},"发票总额",-1)),r("div",_t,"¥"+n(c(l.value.total_amount)),1)])]),_:1})]),_:1}),t(h,{span:8},{default:e(()=>[t(g,{class:"summary-card"},{default:e(()=>[r("div",vt,[a[4]||(a[4]=r("div",{class:"summary-label"},"已收款",-1)),r("div",ft,"¥"+n(c(C())),1)])]),_:1})]),_:1}),t(h,{span:8},{default:e(()=>[t(g,{class:"summary-card"},{default:e(()=>[r("div",yt,[a[5]||(a[5]=r("div",{class:"summary-label"},"未收款",-1)),r("div",bt,"¥"+n(c(B())),1)])]),_:1})]),_:1})]),_:1})]),l.value.payments&&l.value.payments.length>0?(p(),v("div",gt,[t(U,{data:l.value.payments,border:"",style:{width:"100%"}},{default:e(()=>[t(d,{prop:"id",label:"支付ID",width:"80"}),t(d,{prop:"amount",label:"支付金额",width:"120"},{default:e(({row:u})=>[o(" ¥"+n(c(u.amount)),1)]),_:1}),t(d,{prop:"payment_date",label:"支付日期",width:"120"},{default:e(({row:u})=>[o(n(w(u.payment_date)),1)]),_:1}),t(d,{prop:"payment_method",label:"支付方式",width:"120"},{default:e(({row:u})=>[o(n(D(u.payment_method)),1)]),_:1}),t(d,{prop:"reference_number",label:"参考号",width:"150"}),t(d,{prop:"status",label:"状态",width:"100"},{default:e(({row:u})=>[t(k,{type:T(u.status)},{default:e(()=>[o(n(P(u.status)),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"notes",label:"备注"}),t(d,{label:"操作",width:"150"},{default:e(({row:u})=>[t(m,{size:"small",onClick:f=>A(u.id)},{default:e(()=>a[6]||(a[6]=[o("查看")])),_:2,__:[6]},1032,["onClick"]),t(m,{size:"small",type:"primary",onClick:f=>R(u.id)},{default:e(()=>a[7]||(a[7]=[o("编辑")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):(p(),v("div",ht,[a[9]||(a[9]=r("p",null,"该发票暂无支付记录",-1)),t(m,{type:"primary",class:"mt-4",onClick:V},{default:e(()=>a[8]||(a[8]=[o("添加支付记录")])),_:1,__:[8]})]))])):M("",!0)])),[[O,y.value]])])}}});const $t=rt(wt,[["__scopeId","data-v-6873b015"]]);export{$t as default};
