/* empty css                  *//* empty css                   *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css                             */import{d as W,r as D,x as S,o as X,c as _,b as a,e as n,w as l,N as Y,L as $,M as k,t as o,h as j,i as q,n as G,v as H,V as J,R as K,P as Q,l as i,g as r,X as Z,Y as tt,W as et,O as at,U as st}from"./index-3fea3ed3.js";import{c as ot}from"./contract-f802119d.js";import{_ as nt}from"./_plugin-vue_export-helper-c27b6911.js";const lt={class:"page-container"},rt={class:"page-header"},ut={style:{"white-space":"pre-wrap"}},ct={key:1,class:"mt-6"},it={class:"stats-container"},dt={class:"stat-card stat-card-blue"},_t={class:"stat-value"},mt={class:"stat-card stat-card-green"},pt={class:"stat-value"},vt={class:"stat-card stat-card-purple"},ft={class:"stat-value"},yt={class:"stat-card stat-card-orange"},bt={class:"stat-value"},gt={class:"stat-card stat-card-red"},ht={class:"stat-value"},wt={key:0},xt={class:"payment-header"},At={class:"payment-amount"},Ct={class:"amount-text"},Mt={class:"date-text"},kt={class:"payment-tags"},Nt={key:0,class:"reference-number"},Tt={class:"payment-summary"},Dt={key:1,class:"text-gray-500 text-sm"},St={key:2,class:"mt-6"},Et=W({__name:"ContractDetail",setup(It){const N=j(),E=q(),x=D(!1),s=D(),T=S(()=>Number(E.params.id)),h=t=>{if(t==null||t==="")return 0;const e=Number(t);return isNaN(e)?0:e},b=S(()=>{var w;if(!((w=s.value)!=null&&w.invoices)||!Array.isArray(s.value.invoices))return{totalCount:0,totalAmount:0,paidAmount:0,unpaidAmount:0,uninvoicedAmount:s.value?h(s.value.total_amount):0};const t=s.value.invoices,e=h(s.value.total_amount),f=t.length,c=t.reduce((g,y)=>g+h(y.total_amount),0),p=t.reduce((g,y)=>g+C(y),0),M=c-p,v=e-c;return{totalCount:f,totalAmount:c,paidAmount:p,unpaidAmount:M,uninvoicedAmount:v}}),d=t=>new Intl.NumberFormat("zh-CN").format(t),A=t=>new Date(t).toLocaleString("zh-CN"),I=t=>({draft:"info",active:"success",completed:"primary",cancelled:"danger"})[t]||"info",B=t=>({draft:"草稿",active:"执行中",completed:"已完成",cancelled:"已取消"})[t]||t,P=t=>({draft:"info",sent:"warning",paid:"success",overdue:"danger",cancelled:"primary"})[t]||"info",V=t=>({draft:"草稿",sent:"已发送",paid:"已付款",overdue:"逾期",cancelled:"已取消"})[t]||t,z=t=>({pending:"warning",completed:"success",failed:"danger"})[t]||"info",L=t=>({pending:"待处理",completed:"已完成",failed:"失败"})[t]||t,F=t=>({cash:"现金",bank_transfer:"银行转账",check:"支票",credit_card:"信用卡",other:"其他"})[t]||t,C=t=>!t.payments||!Array.isArray(t.payments)||t.payments.length===0?0:t.payments.filter(e=>e.status==="completed").reduce((e,f)=>e+h(f.amount),0),R=async()=>{try{x.value=!0;const t=await ot.getContractById(T.value);t.success&&t.data&&(s.value=t.data)}catch(t){console.error("Failed to fetch contract:",t),G.error("获取合同信息失败")}finally{x.value=!1}},O=()=>{N.push(`/contracts/${T.value}/edit`)},U=()=>{N.go(-1)};return X(()=>{R()}),(t,e)=>{var y;const f=H,c=et,p=at,M=J,v=st,w=K,g=Q;return i(),_("div",lt,[a("div",rt,[e[2]||(e[2]=a("h2",{class:"page-title"},"合同详情",-1)),a("div",null,[n(f,{onClick:U},{default:l(()=>e[0]||(e[0]=[r("返回")])),_:1,__:[0]}),n(f,{type:"primary",onClick:O},{default:l(()=>e[1]||(e[1]=[r("编辑")])),_:1,__:[1]})])]),Y((i(),_("div",null,[s.value?(i(),$(M,{key:0,column:2,border:""},{default:l(()=>[n(c,{label:"合同编号"},{default:l(()=>[r(o(s.value.contract_number),1)]),_:1}),n(c,{label:"合同标题"},{default:l(()=>[r(o(s.value.title),1)]),_:1}),n(c,{label:"客户名称"},{default:l(()=>{var u;return[r(o(((u=s.value.customer)==null?void 0:u.name)||"-"),1)]}),_:1}),n(c,{label:"合同金额"},{default:l(()=>[r("¥"+o(d(s.value.total_amount)),1)]),_:1}),n(c,{label:"开始日期"},{default:l(()=>[r(o(s.value.start_date),1)]),_:1}),n(c,{label:"结束日期"},{default:l(()=>[r(o(s.value.end_date),1)]),_:1}),n(c,{label:"状态"},{default:l(()=>[n(p,{type:I(s.value.status)},{default:l(()=>[r(o(B(s.value.status)),1)]),_:1},8,["type"])]),_:1}),n(c,{label:"创建时间"},{default:l(()=>[r(o(A(s.value.created_at)),1)]),_:1}),n(c,{label:"合同描述",span:2},{default:l(()=>[r(o(s.value.description||"-"),1)]),_:1}),n(c,{label:"合同条款",span:2},{default:l(()=>[a("div",ut,o(s.value.terms||"-"),1)]),_:1}),n(c,{label:"备注",span:2},{default:l(()=>[r(o(s.value.notes||"-"),1)]),_:1})]),_:1})):k("",!0),s.value&&s.value.invoices&&s.value.invoices.length>0?(i(),_("div",ct,[e[8]||(e[8]=a("h3",{class:"text-lg font-semibold mb-4"},"关联发票及收款情况",-1)),a("div",it,[a("div",dt,[e[3]||(e[3]=a("div",{class:"stat-label"},"发票总数",-1)),a("div",_t,o(b.value.totalCount),1)]),a("div",mt,[e[4]||(e[4]=a("div",{class:"stat-label"},"发票总额",-1)),a("div",pt,"¥"+o(d(b.value.totalAmount)),1)]),a("div",vt,[e[5]||(e[5]=a("div",{class:"stat-label"},"未开票总额",-1)),a("div",ft,"¥"+o(d(b.value.uninvoicedAmount)),1)]),a("div",yt,[e[6]||(e[6]=a("div",{class:"stat-label"},"已收款",-1)),a("div",bt,"¥"+o(d(b.value.paidAmount)),1)]),a("div",gt,[e[7]||(e[7]=a("div",{class:"stat-label"},"未收款",-1)),a("div",ht,"¥"+o(d(b.value.unpaidAmount)),1)])]),n(w,{data:((y=s.value)==null?void 0:y.invoices)||[],border:"",style:{width:"100%"}},{default:l(()=>[n(v,{prop:"invoice_number",label:"发票编号",width:"150"}),n(v,{prop:"amount",label:"发票金额",width:"120"},{default:l(u=>[r(" ¥"+o(d(u.row.total_amount)),1)]),_:1}),n(v,{prop:"issue_date",label:"开票日期",width:"120"},{default:l(u=>[r(o(A(u.row.issue_date)),1)]),_:1}),n(v,{prop:"status",label:"发票状态",width:"100"},{default:l(u=>[n(p,{type:P(u.row.status)},{default:l(()=>[r(o(V(u.row.status)),1)]),_:2},1032,["type"])]),_:1}),n(v,{label:"收款情况","min-width":"300"},{default:l(u=>[u.row.payments&&u.row.payments.length>0?(i(),_("div",wt,[(i(!0),_(Z,null,tt(u.row.payments,m=>(i(),_("div",{key:m.id,class:"payment-item"},[a("div",xt,[a("div",At,[a("span",Ct,"¥"+o(d(m.amount)),1),a("span",Mt,o(A(m.payment_date)),1)]),a("div",kt,[n(p,{size:"small",type:z(m.status)},{default:l(()=>[r(o(L(m.status)),1)]),_:2},1032,["type"]),n(p,{size:"small",type:"info"},{default:l(()=>[r(o(F(m.payment_method)),1)]),_:2},1024)])]),m.reference_number?(i(),_("div",Nt," 参考号: "+o(m.reference_number),1)):k("",!0)]))),128)),a("div",Tt," 已收: ¥"+o(d(C(u.row)))+" / 未收: ¥"+o(d(u.row.total_amount-C(u.row))),1)])):(i(),_("div",Dt,"暂无收款记录"))]),_:1})]),_:1},8,["data"])])):s.value&&(!s.value.invoices||s.value.invoices.length===0)?(i(),_("div",St,e[9]||(e[9]=[a("h3",{class:"text-lg font-semibold mb-4"},"关联发票及收款情况",-1),a("div",{class:"text-center py-8 text-gray-500"},[a("p",null,"该合同暂无关联发票")],-1)]))):k("",!0)])),[[g,x.value]])])}}});const Yt=nt(Et,[["__scopeId","data-v-f246c02b"]]);export{Yt as default};
